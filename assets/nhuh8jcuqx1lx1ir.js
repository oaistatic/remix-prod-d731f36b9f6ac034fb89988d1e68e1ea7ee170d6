const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mpg4rqk77vspzi6g.js","assets/lklglvrzltpv3f05.js","assets/i7de8yvdg4jlu6h0.js","assets/root-f8d4ml68.css","assets/mc2tj3xhtcshtn61.js","assets/conversation-small-bez2bigx.css","assets/k7o3w1b1t3xoqtf7.js","assets/ga0gie3a8piuonwy.js","assets/od0q70ax7x1slg7q.js","assets/ow19wq5eskz0jknt.js","assets/dk013urovhoijlg9.js","assets/jwqmomqwr7i8vy2f.js","assets/edmhw3acfg18izr2.js","assets/ia3bxqi6sme14xzy.js","assets/0zwkq4p4h5hlkinb.js","assets/i4m4t1sfl2ukfiy2.js","assets/odbw041be85t4wt9.js","assets/brce3zo6zbrl5a1g.js","assets/fgwhi8yirqbn08vk.js","assets/j3qiy11ber2qn1yq.js","assets/oudi0yqfh7q0w6e5.js","assets/jkk0jkx56s9ds0km.js","assets/hcil7bl6nyyvu0ms.js","assets/c4bxzbp1808foto4.js","assets/heefrlxlra66lmjs.js","assets/gq1oquoigcb35b69.js","assets/c9jtvbm1l824hc0d.js","assets/e6nf8wwu6hfgs3bh.js","assets/oujuzoccndbjtw8y.js","assets/m8uy2g7w7br568yp.js","assets/hqr1r1cc1wkd39ey.js","assets/btkoqt4hbdc97fvt.js","assets/g4x8rasqyp2tikt9.js","assets/f02b02dlobc6ytua.js","assets/eoh3qcov0jni3wda.js","assets/nqq4ud16rlffe18u.js","assets/ofvygecxwbzaihl1.js","assets/k8j3dglerak8lgze.js","assets/nrci5t4pa80sj25y.js","assets/lr2wtvbk3k0uolp8.js","assets/et8bgtraglvdyxgt.js","assets/nudgab5t60clv13n.js","assets/dpnd5rvmowlzdknv.js","assets/f3wqh5wbtzeabanv.js","assets/mk3jxh4of9lq3esr.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/j9pn3dpqp3dnyeg5.js","assets/c2l8elqoquxr1hzw.js","assets/kugo6b3670z02rfe.js","assets/d17yebpu6s43fip7.js","assets/f67w7m6362a1vkss.js"])))=>i.map(i=>d[i]);
import{az as ge,cG as qe,P as K,h as X,bE as wo,b2 as Be,aB as Kt,br as At,aw as D,au as Is,av as ct,h0 as la,cM as jo,c as ei,g as ti,d5 as Ce,bG as dn,f as Ge,aV as We,aW as Ve,dR as un,as as ut,d7 as Mt,v as ee,s as Le,bt as si,al as ze,ab as Nn,bg as Ps,en as Xt,a3 as mn,bq as Co,fQ as ni,fO as oi,ep as ai,cz as ri,dW as Fe,gY as ii,ca as li,o as Ds,F as ca,aX as da,ao as mt,ed as ci,fM as An,ev as di,q as js,cJ as ui,cK as mi,ba as hi,fL as gi,h1 as pi,u as En,aa as Tt,h2 as fi,S as de,cf as xi,D as hn,fX as ua,am as ma,dQ as ha,f1 as vi,W as Si,a8 as Mo,dG as Qt,fD as bi,h3 as ga,Z as Ls,fC as Bs,bo as $e,ap as Rn,gk as In,w as Fs,a2 as Je,bb as To,bR as tt,ar as Ct,J as _t,r as wt,a7 as pa,dX as yi,aZ as wi,be as ji,cA as fa,bS as ae,ch as Ci,fH as Mi,h4 as Ti,Y as Pn,$ as on,e3 as _i,h5 as _o,dZ as xa,d4 as ki,a9 as Ni,eV as va,O as Ai,h6 as Ei,eZ as Ri,bH as Ii,dO as gn,d_ as Pi,n as Ze,cR as Di,dP as Ms,by as hs,M as Sa,at as Li,bi as Bi,h7 as ba,cZ as Fi,eJ as Hi,cF as Ui,bh as Oi,dH as zi,h8 as ya,f$ as Dn,N as Ln,g0 as Gi,h9 as Wi,X as Vi,cY as qi,bd as $i,f4 as et}from"./i7de8yvdg4jlu6h0.js";import{j as e,r as i,M as U,ac as se,ad as Zt,c as Me,au as Yi,f as wa,e as Bn,a as ja,X as Ki,v as Xi,L as pn,R as Ca,av as Qi,aw as Zi,ax as ko}from"./lklglvrzltpv3f05.js";import{aS as Et,hc as Ji,ld as el,le as tl,cR as kt,lf as Ma,lg as Ta,lh as xe,cN as Hs,bJ as qt,li as Ts,lj as Oe,hI as _a,lk as sl,j6 as ka,j9 as Na,gq as nl,B as Aa,fH as ol,j5 as al,ll as Ea,lm as rl,ln as il,lo as Nt,lp as J,lq as Ra,lr as _s,ls as ll,lt as cl,lu as dl,lv as ul,lw as ml,gj as hl,lx as gl,ly as pl,lz as fl,lA as xl,bx as Us,a$ as Ia,lB as vl,lC as Sl,lD as bl,lE as Pa,lF as yl,lG as wl,lH as jl,by as Os,lI as Cl,lJ as Ml,lK as Tl,lL as _l,lM as Da,lN as Fn,fO as Hn,lO as Un,hA as On,hB as dt,hC as zn,E as kl,lP as La,kW as fn,lQ as Gn,lR as Nl,db as Al,fk as El,lS as Rl,lT as Il,lU as Pl,lV as ks,lW as Dl,lX as Ba,lY as Ll,H as Bl,kU as Fl,j_ as Fa,hV as Hl,lZ as Ul,bv as Wn,bw as Ha,dI as Ol,dl as zl,dJ as Ua,ce as Oa,eK as Rt,l_ as Gl,l$ as No,m0 as Ao,m1 as Wl,m2 as Vl,bD as Eo,bA as ql,hZ as $l,ju as Ro,m3 as Yl,m4 as Kl,m5 as Xl,m6 as Vn,m7 as Ql,m8 as Zl,bH as za,gx as qn,g1 as $n,m9 as Io,iI as Jl,bz as ec,ma as tc,i0 as sc,jA as nc,i1 as oc,h_ as ac,mb as rc,bB as xn,mc as ic,md as lc,me as cc,mf as dc,be as vn,mg as uc,cx as zs,U as Ns,cM as As,bV as Yn,cU as mc,mh as hc,mi as gc,mj as pc,hD as fc,mk as xc,ml as vc,mm as Sc,mn as bc,mo as yc,mp as wc,dz as jc,hU as Cc,kg as Mc,mq as Tc,mr as _c,ms as kc,cG as Ga,mt as Nc,fQ as Kn,mu as Ac,fP as Ec,mv as Rc,mw as Ic,mx as Sn,my as Pc,mz as Dc,cP as bn,mA as Lc,mB as Bc,mC as Fc,mD as Wa,ib as Xn,cS as $t,mE as Hc,mF as Uc,mG as Oc,y as zc,mH as yn,k as Va,mI as Qn,mJ as Po,mK as Gc,mL as Wc,mM as Vc,mN as qc,mO as qa,cL as $c,mP as Yc,mQ as Kc,cO as Gs,ez as Cs,eJ as Xc,ig as Qc,mR as Zc,aZ as Do,dQ as Jc,dw as ed,fd as td,mS as sd,Y as Zn,mT as Jn,hK as nd,cF as od,dR as ad,mU as rd,mV as id,aK as ld,mW as Qe,b1 as cd,mX as dd,mY as wn,mZ as ud,m_ as gs,m$ as $a,n0 as md,g$ as hd,n1 as gd,iJ as ps,n2 as pd,d8 as fd,n3 as xd,fD as vd,r as Sd,n4 as bd,n5 as yd,cy as wd,n6 as jd,n7 as Cd,cj as Md,n8 as Td,n9 as Ya,na as Ka,nb as Xa,nc as Qa,nd as jt,eR as eo,ne as _d,jC as kd,nf as Za,ng as Nd,gA as Es,nh as jn,ni as Ad,nj as Ed,nk as fs,bW as Lo,cc as Ja,cd as er,gN as tr,gP as sr,h9 as Rd,nl as Id,h4 as Pd,nm as Dd,nn as Ld,no as Bd,np as Fd,nq as Hd,bu as Ud,dy as Od,gz as zd,bX as Gd,nr as Wd,ha as xs,gM as Vd,gO as qd,gX as $d,ns as Yd,nt as Kd,nu as Xd,nv as Qd,nw as Zd,nx as Jd,ny as eu,nz as tu,nA as su,nB as nu,bF as ou,jU as au,jT as ru,nC as iu,hj as lu,nD as cu,nE as du,nF as nr,A as uu,gb as mu,hs as hu,ht as gu,nG as pu,nH as fu,nI as or,bI as xu,nJ as ar,nK as vu,nL as Su,nM as bu,ch as yu,ci as wu,cg as ju,cl as Cu,nN as Mu,eD as Rs,fF as Tu,b_ as _u,b$ as ku,iD as Nu,jY as Au,nO as Eu,hx as Ru,nP as Iu,nQ as Pu,nR as Du,nS as Lu,nT as Bu,nU as Fu,aM as Hu,fA as Uu}from"./mc2tj3xhtcshtn61.js";import{B as Ou}from"./dk013urovhoijlg9.js";import{C as Cn,g as zu}from"./jwqmomqwr7i8vy2f.js";import{S as rr,a as Gu,b as Wu,G as Vu,L as qu,c as $u}from"./ia3bxqi6sme14xzy.js";import{h as to,s as Yu,i as Ku,j as vs,k as Xu,l as Qu,m as Zu,t as Ju,n as Ws,C as ir,u as lr,o as em,p as cr,c as dr}from"./0zwkq4p4h5hlkinb.js";import{a as tm}from"./i4m4t1sfl2ukfiy2.js";const Bo=ge.div`m-8 flex flex-col items-center`;function Fo(t){return e.jsx(se.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function sm({clientThreadId:t}){const o=qe(t,a=>a?.promptGptRating)?.gizmoId,{data:n}=Et(o);return o==null||n==null||!Ji(n)?null:e.jsx(nm,{gizmoId:o})}function nm({gizmoId:t}){const[s,o]=i.useState(!1),[n,a]=i.useState(!1),r=el(t),l=async u=>{o(!0),setTimeout(()=>{a(!0)},5e3),K.logEvent(X.submitInlineRating,{gizmo_id:t,rating:u}),await r.mutateAsync({rating:u})},c=async()=>{a(!0),K.logEvent(X.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{n||K.logEvent(X.showInlineRating,{gizmo_id:t})},[n,t]),n?null:s?e.jsx(Bo,{children:e.jsxs(Fo,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(U,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(wo,{onClick:()=>{a(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(U,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Bo,{children:e.jsxs(Fo,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(U,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(wo,{onClick:c})]}),e.jsx(tl,{rating:void 0,onRating:l})]})})}const Ss={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},om=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((o,n)=>e.jsx(se.div,{initial:Ss.initial,animate:Ss.animate,transition:{delay:(n-1)*Ss.transition.delay},exit:Ss.exit,children:e.jsx(At,{as:"button",color:"secondary",size:"small",onClick:()=>{s(o,t,n)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(rm,{suggestion:o})},n)},n))});function am({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:o}){const n=t?.length>0;i.useEffect(()=>{n&&kt(t,o)},[n,o]);const{isUnauthenticated:a}=Be();return n?t.every(Ma)?e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[a&&e.jsx(Kt,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(rr,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(Ta)?e.jsx(om,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function rm({suggestion:t}){return Ta(t)?e.jsx(e.Fragment,{children:t.text}):Ma(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:D("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function im(){const{store:t}=xe(),s=t.useSharedProps();return s?e.jsx(lm,{...s}):null}function lm({clientThreadId:t,suggestions:s}){const o=Hs();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(cm,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(am,{suggestions:s,onSelectingSuggestedReply:o,clientThreadId:t})})})})}const cm=ge.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,ur=({className:t,children:s})=>e.jsx(se.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function dm({currentLeafId:t,canContinue:s,onContinueGenerating:o}){const n=i.useCallback(()=>{const r=new qt;o(t,r),Ts()},[o,t]);let a=null;return s&&(a=e.jsx(mm,{onHandleContinueGenerating:n})),a&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:a})}function um({className:t}){return e.jsx(_a,{className:D("-rotate-180",t)})}const mm=({onHandleContinueGenerating:t})=>e.jsx(ur,{children:e.jsx(At,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:um,size:"small",children:e.jsx(U,{...Oe.continueGenerating})})}),hm=({clientThreadId:t})=>{const s=la(),o=Is(t),n=ct(o);i.useEffect(()=>{n&&jo.dismissBanner()},[n]);const a=s?.is_dismissible?()=>jo.dismissBanner():void 0;return e.jsx(Zt,{children:s&&e.jsx(se.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(sl,{clientThreadId:t,rateLimitInfo:s,onDismiss:a})})})};function gm(t){const s=Is(t),o=ct(s),n=la();return!o&&n!=null}const Mn=window.sessionStorage,Tn=ei(ti(()=>({memoryFullBannerDismissed:!!Mn?.getItem(dn.MemoryFullBannerDismissed)}))),mr={dismissBanner(){Tn.setState(t=>{t.memoryFullBannerDismissed=!0}),Mn?.setItem(dn.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Tn.setState(t=>{t.memoryFullBannerDismissed=!1}),Mn?.removeItem(dn.MemoryFullBannerDismissed)}};function pm(t){const s=Ce(t),o=ka(),{data:n}=Na(s,!1,o),a=n!=null,r=a&&n.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&a&&(c(!0),mr.clearDismissedBanner())},[r,a]);const u=Tn(m=>m.memoryFullBannerDismissed);return r&&l&&!u}function fm(){const t=Me(),{openSettings:s}=nl();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Aa,{title:t.formatMessage(bs.memoryFullTitle),content:t.formatMessage(bs.memoryFullTooltip,bs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(bs.memoryManageButton),onPrimaryCtaClick:()=>s(ol.Personalization),onDismiss:()=>mr.dismissBanner()})})}const bs=Ge({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:al,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),xm=()=>{const{shouldShowSkipButton:t}=Ea();return t?e.jsx(ur,{className:"flex justify-center",children:e.jsx(At,{as:"button",color:"secondary",onClick:()=>rl.skipParagen(),children:e.jsx(U,{...vm.skip})})}):null},vm=Ge({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),hr=i.memo(function({className:s}){const{store:o}=xe(),n=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:D(s??"absolute bottom-full left-0 right-0",_s.PromptTextareaHeader),children:e.jsx(il,{shouldRender:n,contentArea:Nt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(gr,{}),e.jsx(pr,{})]})})})});function gr(){const{store:t}=xe(),s=t.useSharedProps(a=>a?.clientThreadId),o=t.useContentAreaId(Nt.HeaderTop);let n;switch(o){case J.ProjectConversationAutoChangeModel:n=e.jsx(jm,{});break;case J.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(ml,{clientThreadId:s});break;case J.ParagenControls:n=e.jsx(xm,{});break;case J.ItemActions:n=e.jsx(im,{});break;case J.BannerSignup:n=e.jsx(ym,{});break;case J.BannerTermsDisclaimer:n=e.jsx(Cm,{});break;case J.PromptTextareaAction:n=e.jsx(Mm,{});break;case J.BannersRateLimit:n=e.jsx(Tm,{});break;case J.BannerSidekickAnnouncement:n=e.jsx(ul,{});break;case J.SearchBrowserExtensionAnnouncement:n=e.jsx(dl,{});break;case J.MemoryInSearchAnnouncement:n=e.jsx(cl,{});break;case J.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(ll,{});break;case J.BannerMemoryFull:n=e.jsx(fm,{});break;case J.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;default:n=null;break}return n}function pr(){const{store:t}=xe(),s=t.useContentAreaId(Nt.HeaderBottom);let o;switch(s){case Ra.DallePromptControls:o=e.jsx(bm,{});break;default:o=null;break}return o}const Sm=We(()=>Ve(()=>import("./mpg4rqk77vspzi6g.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.default));function bm(){const{store:t}=xe(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(Sm,{composerController:s}):null}function ym(){const{store:t}=xe(),s=t.useSharedProps(a=>a?.clientThreadId),o=hl(),n=gl();return s?o?e.jsx(pl,{threadId:s,showSignUp:n}):e.jsx(fl,{threadId:s,showLogin:n}):null}function wm({clientThreadId:t}){const s=Us(t);return e.jsx(Aa,{icon:e.jsx(Ia,{}),content:e.jsx(U,{id:"pc4toA",defaultMessage:"The model {modelName} does not support files or instructions. Your conversation will continue with gpt-4o.",values:{modelName:s?.title}})})}function jm(){const{store:t}=xe(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(wm,{clientThreadId:s}):null}function Cm(){const{store:t}=xe(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(xl,{threadId:s}):null}function Mm(){const{store:t}=xe(),s=t.useSharedProps();return s?e.jsx(dm,{...s}):null}function Tm(){const{store:t}=xe(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(hm,{clientThreadId:s}):null}const _m=i.memo(function(s){return km(s),Nm(s),Am(),null});function km(t){const{store:s}=xe(),o=s.useSetSharedProps();un(()=>{o(t)},[t,o])}function Nm(t){const{clientThreadId:s,canContinue:o}=t,{store:n}=xe(),a=i.useRef({top:n.useContentAreaApi(Nt.HeaderTop),bottom:n.useContentAreaApi(Nt.HeaderBottom)}).current,r=Im(t),l=vl(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:u}=Pm(s),m=gm(s),d=Sl(t),h=bl(t),g=Pa(),v=yl(t),f=pm(s),x=wl(),T=jl(t),y=qe(s,w=>w?.modelId),j=Os(s);un(()=>{y&&j?.kind===ze.GizmoInteraction&&j.gizmo&&_l(y,j.gizmo)?a.top.set(J.ProjectConversationAutoChangeModel):T.eligible?a.top.set(J.AdvancedVoiceOnMobileAnnouncement):x?a.top.set(J.ParagenControls):u?a.top.set(J.BannerTermsDisclaimer):m?a.top.set(J.BannersRateLimit):d.eligible?a.top.set(J.BannerSidekickAnnouncement):g?a.top.set(J.MemoryInSearchAnnouncement):h?a.top.set(J.SearchBrowserExtensionAnnouncement):v?a.top.set(J.SearchBrowserExtensionReactiveAnnouncement):r?a.top.set(J.ItemActions):o?a.top.set(J.PromptTextareaAction):c?a.top.set(J.BannerSignup):f?a.top.set(J.BannerMemoryFull):a.top.set(null)},[a,r,o,u,c,m,d,f,x,T]),un(()=>{l&&a.bottom.set(Ra.DallePromptControls)},[a,l])}function Am(){const{store:t}=xe();i.useEffect(()=>()=>{t.reset()},[t])}function Em(t){const s=Da(),o=ut(t),n=ee.getTree(t).getLastValidNode(o)?.message?.id;return s?.messageId===n?s.suggestions:[]}function Rm(t){return Em(t).length>0}function Im(t){const s=Cl(t.clientThreadId),o=Rm(t.clientThreadId);return t.isDisabled?!1:t.isNewThread||s||o}function Pm(t){const{isUnauthenticated:s}=Be(),o=ut(t),{layer:n}=Mt("3637408529"),a=n.get("should_show_no_auth_signup_banner",!0),r=Ml(g=>g.bannerDisclaimerClientThreadId),l=Tl(),c={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return c;const u=ee.getTree(t),m=u.countMessagesByAuthor(Le.User),d=u.getNodeByIdOrMessageId(o),h=d?.message?.author.role===Le.Assistant&&si(d.message);return c.shouldShowBannerTermsDisclaimer=h&&s&&m===1&&!l&&(r==null||r===t),c.shouldShowBannerSignup=a&&h&&s&&m>0&&m%5===0,c}function Dm({composerController:t,isDisabled:s,highlightTooltip:o,clientThreadId:n}){const{setThreadSearchMode:a}=Fn(),r=Hn(),l=Yi(),[c,u]=i.useState(!1),m=Me(),d={clientThreadId:n};return e.jsx(Bm,{highlightTooltip:o,analyticsMetadata:d,isThreadUsingSearchMode:r,isDisabled:s,children:e.jsxs("button",{className:D("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",c&&"transition-all duration-150",r||o?"!rounded-2xl bg-blue-250 text-blue-1000 hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A]":s?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-pressed":r,"aria-label":m.formatMessage({id:"Sl1VH/",defaultMessage:"Search the web"}),disabled:s,onTransitionEnd:()=>u(!1),onClick:h=>{h.stopPropagation(),h.preventDefault(),u(!0),K.logEventWithStatsig(X.composerSearchButtonClicked,"composer_search_button_clicked",d),a(!r,d,Nn.CONVERSATION_COMPOSER_WEB_ICON),/^search\s?$/i.test(t.getCurrentText())&&t.setText(""),t.replaceSlashCommandTokensWithText(),t.focus()},children:[e.jsx(Un,{}),e.jsx(Zt,{children:r&&e.jsx(se.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:l?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2",children:e.jsx(U,{id:"TbHx8d",defaultMessage:"Search"})})})})]})})}function Lm(){const t=Pa(),s=On(dt.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function Bm({children:t,highlightTooltip:s,analyticsMetadata:o,isThreadUsingSearchMode:n,isDisabled:a}){const r=Lm()&&!n,l=On(dt.hasSeenComposerSearchButtonTooltip);return r?e.jsx(zn,{announcementKey:dt.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(U,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:l.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(U,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(kl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(U,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Ps,{sideOffset:0,label:a?e.jsx(U,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(U,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||(n?!1:void 0),onOpenChange:c=>{c&&K.logEventWithStatsig(X.composerSearchButtonHovered,"composer_search_button_hovered",o)},children:t})})}function Fm({composerController:t,clientThreadId:s}){const o=Xt(s),{setThreadSearchMode:n}=Fn(),r=La().size>0,l=fn(s,mn.Search),c=Gn(s),[u,m]=i.useState([]),[d,h]=i.useState(void 0),[g,v]=i.useState(0);i.useEffect(()=>{m(d?c.filter(_=>_.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||_.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{const _=M=>{h(R=>ri(R,M)?R:M)};t.view.dispatch(Yu(t.view.state.tr,{onHintMatch:_}))},[t]);const f=r||!c.length||!u.length||!d;i.useEffect(()=>{f&&v(0)},[f]);const x=u.length,T=i.useCallback(_=>{v(M=>(_(M)%x+x)%x)},[x]),y=u[g],j=({hintToSave:_=y,expectPerfectMatch:M,appendSpace:R=!0})=>{if(!d||!y||M&&_.name.toLowerCase()!==d.text.toLowerCase())return;K.logEvent(X.systemHintSelected,{system_hint:_.systemHint,conversation_id:o??Co});const E=d.text+_.name.slice(d.text.length),p={clientThreadId:s};Xu(t.view,{id:_.systemHint,hint:E},d.range,R,l,B=>n(B,p,Nn.CONVERSATION_COMPOSER_SLASH_SEARCH)),vs(t.view)},w=i.useRef(j);w.current=j;const S=i.useRef(T);S.current=T;const A=i.useRef(d);A.current=d;const P=t.view;return i.useEffect(()=>(f||Ku(P,_=>{_==="up"?S.current(M=>M-1):_==="down"?S.current(M=>M+1):_==="cancel"?(vs(P),Qu(P)):_==="submit"?(w.current({expectPerfectMatch:!1}),vs(P)):_==="checkMatch"&&w.current({expectPerfectMatch:!0,appendSpace:!1})}),()=>vs(P)),[f,P]),i.useEffect(()=>{f||K.logEvent(X.systemHintListOpened,{conversation_id:o??Co})},[f]),f?null:e.jsx(ni,{className:"max-w-60",onMouseDown:_=>{_.preventDefault()},children:u.map((_,M)=>e.jsx("div",{onMouseOver:()=>v(M),onClick:()=>{j({hintToSave:_,expectPerfectMatch:!1}),t.focus()},children:e.jsx(oi,{autoFocus:!1,className:"group rounded-lg px-1 py-2 hover:bg-token-hint-text",$spoofHovered:M===g,children:e.jsx(Hm,{title:_.name,description:_.description,icon:e.jsx(Nl,{svgString:_.logo,className:"icon-lg text-token-text-secondary group-hover:text-white"}),checked:!1})})},_.systemHint))})}function Hm({title:t,description:s,icon:o,checked:n}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-1.5 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:o}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary group-hover:text-white",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary group-hover:text-white",children:s})]}),n&&e.jsx(ai,{className:D("icon-md text-token-text-primary",{"group-hover:hidden":!n})})]})}function Um({composerController:t,clientThreadId:s}){return t instanceof to?e.jsx(Fm,{composerController:t,clientThreadId:s}):null}function Om({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(se.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:D("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function zm({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:u,isDisabled:m,highlightTooltip:d}){const h=Al(),{gdriveStatus:g,o365Status:v}=El(),f=e.jsx(Pl,{className:u?"text-white":d?"text-brand-blue-800":void 0}),x=g!=="false"||v!=="false"||h;return e.jsx("div",{className:"relative",children:e.jsx(Om,{showBackground:d,className:"bg-brand-blue-800/20",children:x?e.jsx(Rl,{clientThreadId:t,icon:f,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,onOauthRedirect:c,uploadType:s,openFileDialog:l,getInputProps:r,isDisabled:m,highlightTooltip:d}):e.jsx(Il,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,icon:f,isDisabled:m,highlightTooltip:d})})})}function Gm({suggestions:t,composerController:s,onSelect:o,onChange:n}){const a=Hs(),r=i.useCallback((d,h,g)=>{o?.(d,h,g),a(d,h,g)},[o,a]),[l,c]=i.useState(-1),[u,m]=i.useState(!1);return i.useEffect(()=>{const d=h=>{if(h.key==="ArrowDown"){const g=l===t.length-1?0:l+1;c(g),n?.(g,!0,t[g])}else if(h.key==="ArrowUp"){h.preventDefault();const g=l<=0?t.length-1:l-1;c(g),n?.(g,!0,t[g])}else h.key==="Enter"&&!h.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",d)},[t,l,n,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),n?.(-1,!1)}),[s,n]),i.useEffect(()=>{if(!u){const d=()=>{m(!0),window.removeEventListener("mousemove",d)};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}}},[u]),i.useEffect(()=>{c(-1),n?.(-1,!1),m(!1)},[t,n]),e.jsx(se.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((d,h)=>e.jsxs(se.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:h*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[h>0&&e.jsx("div",{className:D("h-[1px] opacity-60 max-lg:hidden",l===h||l===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:D("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===h?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),r(d,t,h)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{u&&(c(h),n?.(h,!1,d))},onMouseLeave:()=>{c(-1),n?.(-1,!1,d)},children:[d.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:d.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:d.autocompletionChunks&&d.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:d.autocompletionChunks.map((g,v)=>e.jsx("span",{className:D(g.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:g.text},v))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:D(d.type===ks.Starter?"text-token-text-secondary":"text-token-text-tertiary"),children:d.title}),e.jsx("span",{className:"text-token-text-primary",children:d.body})]})})]}),h>0&&e.jsx("div",{className:D("h-[1px] opacity-60 lg:hidden",l===h||l===h-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},d.id??h))})}function Wm(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const n=[];let a=0;for(let c=0;c<s.length&&(a<t.length&&t[a]===s[c]&&(n.push(c),a++),a!==t.length);c++);const r=[];let l=0;if(n.forEach(c=>{if(c>l){const u=o.slice(l,c);u&&r.push({text:u,isMatched:!1})}r.push({text:o[c],isMatched:!0}),l=c+1}),l<s.length){const c=o.slice(l);c&&r.push({text:c,isMatched:!1})}return Vm(r)}function Vm(t){if(t.length===0)return t;let s=[t[0]];for(let n=1;n<t.length;n++){const a=s[s.length-1],r=t[n];a.isMatched===r.isMatched?a.text+=r.text:s.push(r)}const o=s.filter(n=>n.isMatched).reduce((n,a)=>n+a.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(n=>n.text).join(""),isMatched:!1}]}const qm=i.forwardRef(function({type:s,placeholder:o,replyRegions:n,state:a,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:u,inputState:m,currentLeafId:d,composerController:h,clientThreadId:g,gizmoId:v,disableReason:f},x){const T=Fe(),y=Dl();let j=null;const{isLoading:w}=y;w||(j=y.modelId),i.useEffect(()=>{w||ii()||h.focus()},[j,h,w]);const S=A=>{Zm({target:A.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()};return e.jsxs("div",{id:"composer-background",ref:x,className:D("flex w-full cursor-text flex-col rounded-3xl px-2.5 py-1 transition-colors contain-inline-size",T&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",T&&s!=="temporary"&&"bg-token-composer-surface",!T&&s!=="temporary"&&"bg-[#f4f4f4] dark:bg-token-main-surface-secondary",s==="temporary"&&"dark bg-black"),onClick:S,children:[e.jsx(Zt,{initial:!1,children:n.length>0&&e.jsx(se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(Ym,{replyRegions:n})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-2",children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:h instanceof Ba?e.jsx($m,{composerController:h,currentLeafId:d,placeholder:o,inputState:m}):e.jsx(Zu,{composerController:h,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"flex h-[44px] items-center justify-between",children:[e.jsx("div",{className:"flex gap-x-1",children:l}),e.jsx(Ll,{inputState:m,state:a,onSubmit:u,composerController:h,clientThreadId:g,gizmoId:v,disableReason:f})]})]})]})});function $m({composerController:t,currentLeafId:s,placeholder:o,inputState:n}){const a=i.useContext(li);return e.jsxs(e.Fragment,{children:[e.jsx(Bl,{id:Fl,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof Ba))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:o,disabled:n!=="default",className:D("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",n==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:a.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Ym({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,o)=>{switch(s.type){case"text":return e.jsx(Km,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"object":return e.jsx(Xm,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"mention":case"system_hint":return e.jsx(Qm,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},o)}})})}function Km({value:t,onRemoveRegion:s}){return e.jsxs(no,{className:"text-token-text-secondary",children:[e.jsx(oo,{children:e.jsx(Fa,{className:"icon-lg-heavy"})}),e.jsx(ao,{children:`“${t}”`}),e.jsx(so,{onClick:s})]})}function Xm({value:t,onRemoveRegion:s}){return e.jsxs(no,{className:"text-blue-selection",children:[e.jsx(oo,{children:e.jsx(Fa,{className:"icon-lg-heavy"})}),e.jsx(ao,{className:"font-semibold",children:t}),e.jsx(so,{onClick:s})]})}function Qm({value:t,icon:s,onRemoveRegion:o}){return e.jsxs(no,{children:[e.jsx(oo,{className:"mt-0",children:s}),e.jsx(ao,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(so,{onClick:o})]})}function so({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Hl,{className:"icon-lg"})})}const no=ge.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,oo=ge.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,ao=ge.span`flex-1 line-clamp-3 py-0.5`;function Zm({target:t,rootId:s,additonalInteractiveIds:o}){let n=t;for(;n&&n!=null;){if(n.tagName==="BUTTON"||n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||o.includes(n.id))return!0;if(n.id===s)return!1;n=n.parentElement}return!1}function Jm({composerController:t,isDisabled:s,clientThreadId:o}){const n=Me(),a=On(dt.hasSeenComposerSystemHintButtonTooltip),l=Gn(o).length>0,u=La().size>0,m=s===!0||!l||u;if(!(t instanceof to))return null;const d=t,h={clientThreadId:o};function g(){K.logEventWithStatsig(X.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",h),a.markAsViewed(),d.focus(),Ju(d.view)}const v=e.jsx("button",{className:D("flex h-8 min-w-8 items-center justify-center rounded-lg p-1 text-xs font-semibold",m?"opacity-30":"hover:bg-black/10 focus-visible:outline-black dark:focus-visible:outline-white"),"aria-label":n.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:m,onPointerDown:g,onMouseDown:f=>{f.preventDefault()},onClick:f=>{f.preventDefault(),f.detail===0&&g()},children:e.jsx(Ul,{})});return!a.isLoading&&a.eligible?e.jsx(zn,{announcementKey:dt.hasSeenComposerSystemHintButtonTooltip,show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(U,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:a.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(U,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."}),children:v}):e.jsx(Ps,{side:"right",sideOffset:0,label:s?e.jsx(U,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(U,{id:"mrYNGk",defaultMessage:"View tools"}),onOpenChange:f=>{f&&K.logEventWithStatsig(X.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",h)},children:v})}const eh=1,th=3e3;function sh({files:t,className:s}){const o=As(),n=Ha(),a=yc();return e.jsxs("div",{className:s,children:[a.map(r=>e.jsx(wc,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(jc,{borderRadius:"2xl",useV2Style:!0,width:o?"normal":"wide",onRemoveFileClick:()=>xn.remove(n,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Cc.Uploading?r.progress:void 0},r.tempId))]})}function nh({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:o,currentModelId:n,clientThreadId:a,isNewThread:r,isCompletionInProgress:l,className:c,disabled:u=!1,disabledReason:m,canPause:d=!1,canContinue:h=!1,suggestions:g,isInteractableSharedThread:v,composerContainerRef:f,autocompletions:x,requiresFileUpload:T,onComposerInput:y,onComposerChange:j,onAutocompleteSelect:w,headerClassName:S,hideHeader:A,setComposerBarElement:P,onTaggingDropdownOpen:_,onTaggingDropdownClose:M}){const R=i.useRef(null),E=Mc(R,P),p=Ws(),B=Wn(),C=Ds(),{isUnauthenticated:H}=Be(),z=Me(),k=ca(),I=Ha(),b=ut(a),F=Is(a),[Y]=wa(),te=Bn(),{gizmoEditorData:q,mode:re,getGizmoId:ie}=Ol(),Q=da(),ue=zl(),Te=mt(),He=Ua(),le=Xt(a),pe=!!ci(),_e=!!An(),[ve,Ee]=i.useState({}),{setThreadSearchMode:Re,clearSearchModeTrigger:Ue,getSearchModeTrigger:ke}=Fn(),O=Hn(),[L,V]=i.useState(!1),[W,Z]=i.useState(!1),ne=Fe(),me=i.useRef(!1),Se=Oa(),oe=n!==null?Se[n]:void 0,Ie=qe(a,N=>N?.overrideModelId);let $=Os(a),be=$&&"gizmo"in $?$.gizmo:void 0;const Pe=Rt(be?.gizmo.id),fe=Gl();let It;be?.gizmo.id&&(Pe?It=No.PROJECT:It=No.GPT);const[ye,Ye]=i.useState(null);ye!==null&&($={gizmo:ye,gizmo_id:ye.gizmo.id,kind:ze.GizmoInteraction},be=ye);const ht=Ao(oe,$);let Pt=!1;Wl($)&&be?.gizmo.id===Vl&&(Pt=!0);const Jt=di(),gt=!u&&!Pt&&ht!==Eo.None&&!H,st=ql(oe,$),Dt=$l(oe,$);let Ne=Ro(N=>N.files);const[Lt]=i.useState(()=>Yl());re==="magic"?Ne=Ne.filter(N=>N.gizmoId!=null):Ne=Ne.filter(N=>N.gizmoId==null);const es=Kl(),pt=Ne.length>0||es,Bt=Ro(Tc.hasUploadInProgress),Ft=p.useState(N=>{const ce=Xl(N);return typeof oe?.maxTokens=="number"&&ce>oe.maxTokens}),Ke=p.useState(N=>!N.isEmpty()),nt=!Ft&&!Bt&&(Ke||pt);Vn(Ne.length>0||Bt||Ke);const ts=(ht===Eo.Multimodal?Ql:Zl)-Ne.length,ot=ts<=0,Xe=nt&&!u&&!l&&!_e,[at,Ht]=i.useState(!1),ft=za(),xt=n||ft.id,Vs=fn(a,mn.Search),ss=!u&&!be&&Q?.includes(js.SearchTool)&&!Q?.includes(js.SearchToolHoldout)&&(Q?.includes(js.BrowsingAvailable)||!C?.isEnterprisey()),ns=ss&&Vs,os=Se[xt]?.tags,{targetedContent:qs,setTargetedContent:vt}=qn(),we=qs?.isFocusedViewContent&&!He?void 0:qs,{rebaseSystemMessageContent:$s}=$n();i.useEffect(()=>{if(!B?.id)return;const N=Io.getAndReset(B?.id,le);N&&p.setText(N.inputText)},[B?.id,le,p]),i.useEffect(()=>{at!==Xe&&(Ht(Xe),Xe&&ui(!0).then(N=>{Jl.startEnforcement(N),mi.startEnforcement(N)}))},[Xe,at,$?.kind,Q]);const Ut=ec(oe,$),{handleFileAccepted:Ys}=tc(z,Ao(oe,$),st,"mouse",ie,Ut?.attachments),{getInputProps:Ks,open:Xs}=sc({disabled:u||!gt||ot,noClick:!0,onDropAccepted:Ys,onDropRejected:N=>nc(N,z,k,ht),multiple:!0,maxSize:oc,maxFiles:ts,...ac(Dt)}),as=hi(Lt),rs=i.useCallback(()=>{p.eraseContent(),as.clearMessages(),p.resize(eh),ee.clearOverrideModelId(a),rc();for(const N of Ne)xn.remove(I,N.tempId,"none");ic.markAllAsSent()},[p,as,Ne,I,a]),St=async(N,ce)=>{if(N?.preventDefault(),u||!nt&&!ce||!$||Tt.isLoading(a)!==!1)return;const Ae=new qt({gizmoType:It});V(!0),fe?.();const je=p.getContentToSend(),rt=_c(je.content),tn=`${b}-nextPrompt`,Gt=new kc(Ga.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Zr,attachments:xo}=Nc(I,rt,oe,$),vo=[],sn=[];$s&&sn.push(fi($s));const nn={...$};"gizmo"in nn&&delete nn.gizmo;let us=p.getSystemHints();O&&(us=[Kn.Search]);const So=ke(),Jr=O?So??Nn.CONVERSATION_COMPOSER_WEB_ICON:void 0,bo=Ac(),yo=Ec();let Wt={promptId:tn,content:Zr,eventMetadata:{eventSource:N?"mouse":"keyboard"},completionMetadata:{suggestions:g,conversationMode:nn,systemHints:us,searchSource:Jr},messageMetadata:{...xo.length>0&&{attachments:xo},...ye&&{gizmo_id:ye?.gizmo.id},...ve,...us.length>0&&{system_hints:us},...!!je.metadata&&{serialization_metadata:je.metadata},...bo.length>0&&{canvas:{user_created_textdocs:bo.map(ms=>({user_created_temp_textdoc_id:ms.tempTextdocId,type:ms.type,title:ms.title,content:ms.content}))}},...Object.keys(yo).length>0&&{__internal:{search_settings:yo}}},prependMessages:vo.length>0?vo:void 0,appendMessages:sn.length>0?sn:void 0,turnTracker:Ae,profiler:Gt,requestedModelId:Ie};Wt=Rc(Wt),we?.createNewCompletionParams&&(Wt=await we.createNewCompletionParams(Wt)),Gt.logTiming("request_params_ready"),await s(Wt),we?.onCreateCompletion?.({serverThreadId:le,currentLeafId:b}),we?.shouldPersistAcrossMessages!==!0&&vt(void 0),Ns.hideThreadHeader(),rs(),V(!1),Gt.logTiming("prompt_submitted"),g!==void 0&&(de.logEvent("chatgpt_prompt_ignore_suggestions"),K.logEvent(X.promptIgnoreSuggestions)),O&&So&&Ue()},Qs=i.useRef(St);i.useEffect(()=>{Qs.current=St});const Zs=N=>{vt(N.targetedReply),N.targetedReply&&(p.focus(),K.logEvent(X.targetedReplyButtonClicked,{conversationId:le,sourceMessageId:N.messageId}))},G=i.useCallback(()=>{we?.onCleared?.({serverThreadId:le,currentLeafId:b}),vt(void 0),p.focus()},[b,le,we,vt,p]),he={Enter:{validator:N=>{const ce=N.isComposing||N.keyCode===229;return!(W&&me.current)&&(N.metaKey||(ue||xi)&&!N.shiftKey&&!ce)},handler:N=>{if(!Xe){Ft&&k.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}N.preventDefault(),St()}},Escape:{validator:N=>!N.isComposing,handler:N=>{d&&l&&(t("",F),K.logEvent(X.pauseCompletion,{threadId:ee.getServerThreadId(a),currentLeafId:ee.getTree(a).getMessageId(b),eventSource:"keyboard"})),N.target.value===""&&G()}}},De=i.useRef(he);De.current=he;const bt=lc(os,$?.kind),[Ot,is]=i.useState(!1),[Js,io]=i.useState(!1),ls=bt&&Ot&&!Pe,lo=p.isReady();i.useEffect(()=>p.subscribe("keydown",N=>{p.acceptLegacyKeydown()&&De.current[N.key]?.validator(N)&&De.current[N.key].handler(N);const Ae=p.getCurrentText();if(N.key==="@"){const je=p.getSelectionStart(),rt=Ae.substring(0,je);(!rt||/\s$/.test(rt)||je===0)&&setTimeout(()=>is(!0),10)}else Ot&&is(!1);if(N.key==="Escape"&&(Ye(null),Z(!1)),ns&&!O){let je;N.key==="Backspace"?je=Ae.substring(0,Ae.length-1):je=Ae+N.key,/^search\s?$/i.test(je)?io(!0):Js&&io(!1)}O&&N.key==="Escape"&&Re(!1,{clientThreadId:a})}),[p,lo,Ot,Js,ns,O,Re,a]),i.useEffect(()=>{const N=Object.fromEntries(Object.keys(De.current).map(ce=>[ce,je=>{const rt=De.current[ce];if(!rt||p.acceptLegacyKeydown())return!1;const{validator:tn,handler:Gt}=rt;return tn(je)?(Gt(je),!0):!1}]));p.registerKeyHandlers(N)},[p,lo]),i.useEffect(()=>p.subscribe("paste",N=>{cc({filePickerStore:I,event:N,intl:z,toaster:k,clientThreadId:a,conversationMode:$,currentModelConfig:oe,getEditorGizmoId:ie,modelSupportedImageMimeTypes:st})}),[z,a,$,oe,ie,st,p,k,I]);const Er=N=>{pe||Ye(N),p.trimLeadingText("@"),Ts(),is(!1)},Rr=dc(a,Lt,st,Ut?.attachments),Ir=i.useCallback(N=>{N?.preventDefault(),t("",F),K.logEvent(X.pauseCompletion,{threadId:ee.getServerThreadId(a),currentLeafId:ee.getTree(a).getMessageId(b),eventSource:"mouse"}),Ts()},[t,a,F,b]),co=i.useCallback(()=>{Io.set(B?.id,le,p.getCurrentText())},[le,B?.id,p]);i.useEffect(()=>{q||!L&&!gi()&&p.focus()},[L,p]),i.useEffect(()=>{q||xn.reset(I)},[n,I,q]),i.useEffect(()=>{(!bt&&ye||pe)&&Ye(null)},[bt,ye,pe]);const[uo,Pr]=(()=>{switch(m){case"workspaceDisallowsGizmo":return[Oe.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Oe.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Oe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Oe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Oe.loading,!0];case"noTestGizmoId":return[Oe.noTestGizmoId,!0];default:return v?[Oe.placeholderWithName,!1]:we?.placeholderTextOverride!=null?[we.placeholderTextOverride,!1]:[Oe.placeholderWithName,!1]}})(),Dr=Pe?r?z.formatMessage(vn.newChatInProject):z.formatMessage(uo,{name:"ChatGPT"}):z.formatMessage(uo,{name:q!=null?re==="magic"?uc:q.name||"GPT":be?.gizmo.display.name??"ChatGPT"});i.useEffect(()=>p.subscribe("input",()=>{zs.getState().isThreadHeaderVisible&&Ns.hideThreadHeader(),Z(!0)}),[p]),i.useEffect(()=>{if(y)return p.subscribe("input",()=>{y?.()})},[p,y]),i.useEffect(()=>{if(j)return p.subscribe("change",()=>{j?.()})},[p,j]),i.useEffect(()=>p.subscribe("focus",()=>{Z(!0)}),[p]);const mo=Gn(a).length>0,ho=$?.kind===ze.PrimaryAssistant||$?.kind===ze.GizmoInteraction&&Pe,go=mo&&ho&&!O,Lr=As(),Br=mo&&ho&&!Lr,Fr={clientThreadId:a,uploadType:ht,modelAcceptedMimeTypes:Dt,modelSupportedImageMimeTypes:st,attachmentsProductFeature:Ut?.attachments,getInputProps:Ks,openFileDialog:Xs,historyDisabled:Te,onOauthRedirect:co,highlightTooltip:T&&!pt},cs=[],Hr=!u&&!ot&&(gt||Jt!=null)&&!O;cs.push(e.jsx(zm,{...Fr,isDisabled:!Hr},"file-upload-button")),Br&&cs.push(e.jsx(Jm,{composerController:p,clientThreadId:a,isDisabled:!go},"system-hint-button")),ss&&cs.push(e.jsx(Dm,{composerController:p,highlightTooltip:Js,clientThreadId:a,isDisabled:!ns||pt},"search-button"));const Ur=pt&&e.jsxs(e.Fragment,{children:[re==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(U,{...Oe.gizmoKnowledgeWarning})}),e.jsx(sh,{files:Ne,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),Or=Pr?"disabled":"default",zr=l&&d,Gr=pi(),Wr=!Xe||L||Gr,Vr=Ic(Bt,Ke,Ft),ds=zr?"streaming":Wr?"disabled":"idle",zt=i.useRef(null),yt=i.useRef(null),qr=n&&n.startsWith("o1");i.useEffect(()=>{const N=()=>{zt.current!=null&&hn.addAction("composer_state_disabled",{threadId:ee.getServerThreadId(a),disabledReason:zt.current})};if(nt&&ds==="disabled"){let ce="unknown";u?ce=m??"component_disabled_unknown":l?ce="completion_in_progress":_e?ce="thread_hard_blocked":L&&(ce="starting_new_completion_request"),zt.current!==ce&&(yt.current&&clearTimeout(yt.current),yt.current=setTimeout(N,th)),zt.current=ce}else zt.current=null;return()=>{yt.current&&(clearTimeout(yt.current),yt.current=null)}},[a,nt,ds,u,m,l,_e,L]);const en=[];if(we?.label&&en.push({type:we.type,value:we.label,onRemoveRegion:G}),ye!==null){const N=!!ye.gizmo.tags?.includes(Yn.FirstParty);en.push({type:"mention",value:ye.gizmo.display.name,icon:e.jsx(mc,{isFirstParty:N,src:ye.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Ye(null),p.focus()}})}i.useEffect(()=>{(!x||x.length===0||!W)&&(me.current=!1)},[x,W]);const $r=(N,ce,Ae)=>{me.current=N>=0,ce&&p.setText(Ae?`${Ae.title}${Ae.body}`:"")},po=W&&x&&x.length>0&&!ls&&!p.hasMultipleLines()&&p.canShowAutocompletion();i.useEffect(()=>{ls?_?.():M?.()},[ls,_,M]);const fo=ds==="streaming"?Ir:St,Yr=fn(a,mn.Canvas),{value:Kr}=En("61299031"),Xr=As(),Qr=Yr&&Kr&&!es&&!Xr;return e.jsxs(hc.Provider,{value:Lt,children:[e.jsx(gc,{onOauthRedirect:co,children:e.jsx("form",{className:c,onSubmit:fo,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!A&&!ne&&e.jsx(hr,{className:S}),ls&&e.jsx("div",{className:D("absolute bottom-full my-3",r&&"lg:top-full",_s.TagGpt),children:e.jsx(pc,{onClick:N=>Er(N),onClose:()=>{is(!1),p.focus()}})}),go&&e.jsx("div",{className:D("absolute bottom-full my-3",r&&"lg:top-full",_s.TagGpt),children:e.jsx(Um,{composerController:p,clientThreadId:a})}),e.jsxs("div",{ref:f,className:"group relative flex w-full items-center",children:[r&&Y.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{te("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(fc,{className:"icon-lg"})}),e.jsx(qm,{type:Te?"temporary":"default",ref:E,replyRegions:en,placeholder:Dr,inputState:Or,composerController:p,leftSideActions:cs,topRightAction:Qr&&e.jsx(xc,{composerRef:R,composerController:p,clientThreadId:a}),state:ds,onSubmit:fo,renderFiles:Ur,currentLeafId:b,clientThreadId:a,gizmoId:be?.gizmo.id,disableReason:Vr,modelId:xt}),po&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(Gm,{suggestions:x,composerController:p,onSelect:w,onChange:$r})})]}),e.jsx(vc,{composerController:p,parsedDocumentHandler:Rr})]})})}),e.jsx(_m,{canUseInlineTagging:bt,isDisabled:u,clientThreadId:a,currentLeafId:b,currentRequestId:F,canContinue:h,composerController:p,setPromptInputMetadata:Ee,suggestions:g,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:o,onResetState:rs,conversationMode:$,isShowingAutocomplete:!!po}),$!=null&&!qr&&Sc.includes($.kind)&&e.jsx(bc,{clientThreadId:a,onTargetedReply:Zs})]})}function oh(t){const s=t.message?.author.role===Le.User,o=t.metadata?.err!=null&&t.metadata?.errCode!==To.ContentPolicy,n=t.metadata?.errCode===To.ModelIncompatibility;return t.metadata?.canRetry===!1||n?!1:s||o}function ah(t){return e.jsx(ir,{clientThreadId:t.clientThreadId,children:e.jsx(rh,{...t})})}function rh({clientThreadId:t,isNewThread:s,currentModelId:o,showPromptStarters:n,noWrap:a,onRequestCompletion:r,composerContainerRef:l}){const c=Ws(),u=Rn(),m=In(),d=Fs(g=>{const v=Tt.getCurrentNode(t,g);return oh(v)});if(Wa(c),!m&&d)return e.jsx(ih,{clientThreadId:t});const h=e.jsx(e.Fragment,{children:e.jsx(fr,{composerContainerRef:l,clientThreadId:t,currentModelId:o,isNewThread:s,showPromptStarters:n,onRequestCompletion:r})});return a?h:e.jsxs(e.Fragment,{children:[e.jsx(sm,{clientThreadId:t}),e.jsx(Xn,{clientThreadId:t,isStaticSharedThread:u,withVerticalPadding:!1,withHorizontalPadding:!0,children:e.jsx($t,{children:h})})]})}function ih({clientThreadId:t}){const s=Hc(t),o=Fs(r=>Tt.getCurrentNode(t,r).metadata?.errCode===Uc),n=Oc(r=>r.isoDate),a=ut(t);return o&&n!=null&&n!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs",children:e.jsx(U,{...Ho.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(At,{as:"button",color:"primary",onClick:()=>{const r=new qt;de.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,Je({clientThreadId:t})),s({id:a,eventMetadata:{eventSource:"mouse"},conversationMode:Tt.getConversationMode(t),turnTracker:r})},className:"m-auto",icon:_a,"data-testid":"regenerate-thread-error-button",children:e.jsx(U,{...Ho.regenerateResponse})})})]})}function fr({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:n,showPromptStarters:a,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:u,onComposerChange:m,onAutocompleteSelect:d,headerClassName:h,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:f}){const x=ut(t),T=Is(t),y=Sn(),{isUnauthenticated:j}=Be(),S=ua(t)===ma.STREAMING,A=ha({clientThreadId:t,conversationLeafId:x}),P=ct(T),_=vi({clientThreadId:t}),M=!j,R=Si(),{isOpen:E,onClose:p}=Pc({type:"just-hit-rate-limit"}),B=i.useCallback((L,V)=>{K.logEvent(X.continueCompletion),n({type:Mo.Continue,promptId:L,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Tt.getConversationMode(t)},turnTracker:V})},[n,t]),C=ja(),H=i.useCallback(async(L,V)=>Dc({clientThreadId:t,currentRequestId:V,isHistoryAndTrainingDisabled:R,queryClient:C}),[t,R,C]),z=i.useCallback(async({promptId:L,content:V,eventMetadata:W,completionMetadata:Z,messageMetadata:ne,prependMessages:me,appendMessages:Se,turnTracker:oe,profiler:Ie,requestedModelId:$})=>{const be=ee.getThreadCurrentLeafId(t);ee.updateTree(t,Pe=>{Pe.addNode(L,V,be,Le.User,void 0,ne)}),await n({type:Mo.Next,promptId:L,eventMetadata:W,cancelActiveRequests:!0,completionMetadata:Z,prependMessages:me,appendMessages:Se,turnTracker:oe,profiler:Ie,...$?{requestedModelId:$}:{}})},[t,n]),k=qe(t,L=>L?.tree.getHasErrorFromNode(x)??!1),I=qe(t,L=>L?.tree.isMessageIncomplete(x)??!1),b=!A&&(P||S),F=i.useMemo(()=>b?!1:!k&&I,[k,I,b]),Y=b,te=Qt(t),q=Ce(t),re=Et(q).data,{promptStarters:ie,isSuccess:Q}=bn(o&&!te,t,4),ue=Da(),Te=(()=>{if(ue?.messageId===ee.getTree(t).getLastValidNode(x)?.message?.id)return ue?.suggestions;if(a&&!te&&Q&&!M)return ie})(),He=Lc(),le=bi(),pe=(()=>{if(re?.gizmo.tags?.includes(Yn.WorkspaceDisabled)&&!le)return"workspaceDisallowsGizmo";if(He.size){if(y.displayingSideBySideFeedback&&y.unskippable)return"feedbackRequired"}else return"noModelsAvailable";const V=Tt.getConversationMode(t);return V?.kind===ze.GizmoTest&&V.gizmo_id==null?"noTestGizmoId":null})(),_e=ga(t),ve=Ls(t),Ee=En("15117983")?.value,Re=Ki(),Ue=Bs(),ke=Re.action==="moderate",{value:O}=$e("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:Ue&&ke&&O?e.jsx(Bc,{}):null}),E?e.jsx(Fc,{onClose:p}):null,Ee&&ve&&ve.kind===ze.PrimaryAssistant&&ve.plugin_ids&&ve.plugin_ids.length>0?e.jsx(lh,{}):e.jsx(nh,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:z,onAbortCompletion:H,onContinueGenerating:B,currentModelId:s,isNewThread:o,isCompletionInProgress:_,className:"w-full",canContinue:F,suggestions:Te??[],disabled:!!pe,disabledReason:pe??void 0,canPause:Y,isInteractableSharedThread:_e,autocompletions:l,requiresFileUpload:c,onComposerInput:u,onComposerChange:m,onAutocompleteSelect:d,headerClassName:h,hideHeader:g,onTaggingDropdownClose:v,onTaggingDropdownOpen:f},t)]})}function lh(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(U,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Ho=Ge({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),xr=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${_s.PromptTextareaHeader}`,children:[e.jsx(gr,{}),e.jsx(pr,{})]})}),Tg=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:xr},Symbol.toStringTag,{value:"Module"})),Uo=We(()=>Ve(()=>import("./ga0gie3a8piuonwy.js"),__vite__mapDeps([7,1,4,2,3,5,8,9,10,11,12,13,14,15])).then(t=>t.SnorlaxSplashScreen)),an=4;function ch(t){const{layer:s}=tt("3533083032"),{layer:o}=Mt("3533083032"),{value:n,isLoading:a}=$e("3006519778");return a||!n?!1:t?s.get("enable_new_homepage_anon",!1):o.get("enable_new_homepage_anon",!1)}function dh(){const{layer:t}=Mt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),o=Wn();return!!o&&o.created*1e3>=new Date(s).getTime()}function uh(t){const{layer:s}=tt("4031588851"),{layer:o}=Mt("4031588851"),{value:n,isLoading:a}=$e("633009675");return a||!n?!1:t?s.get("enable_new_autocomplete_homepage",!1):o.get("enable_new_autocomplete_homepage",!1)}const rn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function vr(t){const s=Ce(t.clientThreadId),o=Rt(s);return e.jsx(ir,{clientThreadId:t.clientThreadId,children:o&&s&&Uo?e.jsx(Uo,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(fh,{...t})})}function mh({children:t}){const{store:s}=xe(),[o,n]=i.useState(!1),a=Ws();i.useEffect(()=>a.subscribe("focus",()=>{n(!0)}),[a]),i.useEffect(()=>a.subscribe("blur",()=>{n(!1)}),[a]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&o)}function hh({isUnauthenticated:t,shouldShowLegacyStarterPrompts:s,legacyPromptStarters:o,isSendBlocked:n,clientThreadId:a}){return e.jsxs("div",{className:D(t?"justify-end lg:justify-center":"justify-center","flex h-full flex-shrink flex-col items-center overflow-y-hidden text-token-text-primary lg:hidden"),children:[e.jsx("div",{className:D(t&&"flex sm:items-center md:flex-1","flex-shrink-0"),children:e.jsx(Kt,{className:"mb-6 h-12 w-12"})}),s&&(o&&o.length>0?e.jsx(bh,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},promptStarters:o,isSendBlocked:n,clientThreadId:a,isSquare:t}):e.jsx(Gu,{}))]})}function gh({isSendBlocked:t,clientThreadId:s,headlineOption:o,enableNewMobileDesign:n,shouldShowStarterPrompts:a,promptChips:r,onSelectStarterPrompt:l,starterPromptExpanded:c,setStarterPromptExpanded:u}){const m=Qn();return e.jsx(mh,{children:d=>e.jsxs(se.div,{initial:{opacity:0},animate:{opacity:d?0:1},exit:{opacity:0},transition:{duration:.1},className:D("justify-center",d?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] flex h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary",m?"@lg/thread:hidden":"lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(Kt,{className:"inline-block h-12 w-12"}):e.jsx(Sr,{headlineOption:o}),e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:D(!n&&(m?"@lg/thread:hidden":"lg:hidden"),!c&&"h-[116px]"),children:a&&e.jsx(br,{starterPrompts:r,onSelectStarterPrompt:l,disabled:t,clientThreadId:s,onExpand:()=>u(!0),mobileLayout:!0})})]})})}function ph(t,s,o){const n=$e("1468311859").value,a=$e("3664702598").value,{layer:r}=tt("4031588851"),l=dh(),c=t||s,u=c&&n,m=c&&a&&l;let d="HARDCODED";if(c)if(o){const h=r.get("search_autocomplete_mode","");u&&h&&(d=h)}else m&&(d=r.get("autocomplete_mode","HARDCODED"));return d}function fh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,v2HomepageDisclaimer:a}){const r=Ws(),l=Ct(t),c=Qt(t),u=An(),[m,d]=i.useState([]),{trendingSuggestions:h,fetchTrendingSuggestions:g}=yh(an),v=i.useRef(!1),{isUnauthenticated:f}=Be(),x=zc(),[T,y]=i.useState(!1),j=Hn(),w=Fe();Wa(r);const S=$e("589604007").value,{layer:A}=Mt("4031588851"),{layer:P}=tt("4031588851"),{layer:_}=Mt("3533083032"),{layer:M}=tt("3533083032"),{promptStarters:R,isSuccess:E}=bn(l&&!c&&o,t,8,S,!0,s??void 0),{promptStarters:p,isSuccess:B,isError:C}=bn(l&&!c&&o,t,4,void 0,void 0,s??void 0),H=x&&!!m.find(O=>!!O.requires_file_upload),z=i.useCallback(O=>{const L=r.getCurrentText();return L&&rn(O).startsWith(L.toLocaleLowerCase())},[r]),k=i.useCallback(O=>{const L=r.getCurrentText(),V=O.title+O.body;return z(O)?{...O,title:L,body:V.slice(L.length)}:{...O,title:V,body:""}},[r,z]),I=i.useCallback((O=!1)=>{d(L=>!L.some(z)&&L.length>0?[]:O?L:L.map(k))},[z,k]),b=(O,L,V)=>{const W=O.title;d([]),r.focus(),r.setText(W),requestAnimationFrame(()=>{const Z=(R?.filter(ne=>ne.theme===O.theme)??[]).map(ne=>{const me=wt(ne.oneliner),Se=me.startsWith(ne.title);return{...ne,title:Se?`${ne.title} `:"",body:Se?ne.body:me,autocompletionChunks:Wm(W,me),type:ks.Autocomplete}});d(Z),Z.length>0&&kt(Z,t),Vc(O,V,t)})};i.useEffect(()=>{const O=m.some(L=>L.theme===yn.Search);j&&r.getCurrentText()===""?h.length>0?d(h):g():O&&!j&&d(L=>L.filter(V=>V.theme!==yn.Search))},[m,j,h,g,r]);const F=R?.reduce((O,L)=>(L.theme&&!O[L.theme]&&(O[L.theme]=L),O),{}),Y=[];if(F)for(const O in F)Y.push(F[O]);const te=Y&&Y.length>0,q=!!(E&&te&&o),re=!!((B||C)&&o),ie=an-m.filter(z).length,Q=f?M.get("enable_new_mobile",!1):P.get("enable_new_mobile",!1),ue=ph(Q,x,j),Te=f?_.get("headline_option","HELP_WITH"):A.get("headline_option","HELP_WITH"),He=A.get("autocomplete_min_char",4),le=A.get("autocomplete_fetch_interval",200),pe=i.useRef(null),_e=i.useCallback(Va(async O=>{const L=r.getCurrentText();if(!L||L.length<He||L.length>80||r.hasMultipleLines()){d([]);return}if(!v.current&&!(pe.current&&pe.current.length>He&&L.startsWith(pe.current)))try{const V=await _t.generateAutocompletions(L,O,j);if(V.completions.length===0){pe.current=L;return}const W=V.completions.map(Z=>({id:Xi(),type:ks.Autocomplete,title:Z.slice(0,L.length),body:Z.slice(L.length),oneliner:Z,prompt:Z,source:ue})).filter(z).map(k);d(Z=>{const ne=Z.filter(z),me=W.filter(Se=>{const oe=rn(Se);return!ne.some(Ie=>{const $=rn(Ie);if(oe===$)return!0;const be=/[\p{P}\p{S}]$/u,Pe=oe.replace(be,""),fe=$.replace(be,"");return Pe===$||oe===fe||Pe===fe})}).slice(0,an-ne.length);return[...ne,...me]}),W.length>0&&kt(W,t)}catch{}},ue==="BING"?150:le),[r,ue,k,le]),ve=i.useCallback(()=>{I(),ie>0&&_e(ie)},[_e,I,ie]);i.useEffect(()=>{v.current&&d([])},[v]);const Ee=i.useMemo(()=>ue==="HARDCODED"?I:ve,[ue,ve,I]),Re=i.useCallback(()=>{r instanceof to&&I(!0),r.getCurrentText().indexOf(`
`)>0&&d([])},[r,I]),Ue=i.useCallback((O,L,V)=>{L.forEach(W=>{W.id===O.id&&(W.userInput=r.getCurrentText())}),d([L[V]])},[r]),ke=Qn();return e.jsx(e.Fragment,{children:e.jsx(Zt,{children:e.jsx("div",{className:D("h-full w-full",ke?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(Xn,{isStaticSharedThread:!1,withVerticalPadding:!1,withHorizontalPadding:!0,clientThreadId:t,fullHeight:!0,children:e.jsxs(Po,{children:[e.jsx("div",{className:D("mb-7 hidden text-center",ke?"@lg/thread:block":"lg:block"),children:Te==="CHATGPT_LOGO"?e.jsx(Kt,{className:"inline-block h-12 w-12"}):e.jsx(Sr,{headlineOption:Te})}),!Q&&e.jsx(hh,{isUnauthenticated:f,shouldShowLegacyStarterPrompts:re,legacyPromptStarters:p,isSendBlocked:u,clientThreadId:t}),Q&&e.jsx(gh,{headlineOption:Te,enableNewMobileDesign:Q,shouldShowStarterPrompts:q,promptChips:Y,onSelectStarterPrompt:b,starterPromptExpanded:T,setStarterPromptExpanded:y,isSendBlocked:u,clientThreadId:t}),e.jsx("div",{className:D(ke?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Po,{children:w?e.jsx(xr,{}):e.jsx(hr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(fr,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:n,showPromptStarters:!1,autocompletions:m,requiresFileUpload:H,onComposerInput:Ee,onComposerChange:Re,onAutocompleteSelect:Ue,onTaggingDropdownClose:()=>{v.current=!1},onTaggingDropdownOpen:()=>{v.current=!0},hideHeader:!0})}),e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:D("hidden",ke?"@lg/thread:block":"lg:block",a&&f&&T?"":"h-[70px]"),children:q&&e.jsx(br,{starterPrompts:Y,onSelectStarterPrompt:b,disabled:u,clientThreadId:t,onExpand:()=>y(!0)})}),a&&e.jsx("div",{className:D("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",ke?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:"min-h-4",children:a})})]})})})})})}function Sr({headlineOption:t}){const o=Me().formatMessage(wh[t]||Vt.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{children:o})})}function xh({starterPrompt:t,starterPrompts:s,index:o,disabled:n,onSelectStarterPrompt:a}){const r=t.theme??t.title,l=Hs(),{mutate:c}=qc(),u=t.category==="onboarding"?()=>{c({key:dt.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,o)}:()=>a(t,s,o);return e.jsx(qa,{disabled:n,onClick:u,icon:e.jsx($c,{starterPrompt:t,useV2Colors:!0}),label:r})}function Oo({clientThreadId:t,onClick:s}){i.useEffect(()=>{Yc(t)},[t]);const o=Me();return e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(qa,{onClick:()=>{Kc(t),s()},label:o.formatMessage(Vt.moreStarterPrompts)})})}const vh=5,Sh=3;function br({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:n,onExpand:a,mobileLayout:r=!1}){const l=r?Sh:vh,[c,u]=i.useState(l),[m,d]=i.useState(!1),h=i.useRef(null),g=t.length<=c;i.useEffect(()=>{kt(t.slice(0,l),n)},[n]),i.useEffect(()=>{if(!m&&!g&&h.current){const f=h.current,x=f.getBoundingClientRect(),T=x.width,y=Array.from(f.children);let j=0;for(let w=0;w<y.length&&y[w].getBoundingClientRect().right-x.left<=T;w++)j++;u(j),d(!0)}},[t,g,m]);const v=()=>{const f=t.slice(c,t.length).map(x=>({...x,isAdditional:!0}));f.length>0&&kt(f,n),u(t.length),a()};return e.jsxs("div",{className:D("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",m&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:D("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:h,children:[t.slice(0,c).map((f,x)=>e.jsx(se.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(xh,{starterPrompt:f,starterPrompts:t,index:x,disabled:o,onSelectStarterPrompt:s})},f.id??x)),r&&t.length>c&&e.jsx(Oo,{clientThreadId:n,onClick:v})]}),!r&&t.length>c&&e.jsx(Oo,{clientThreadId:n,onClick:v})]})}function bh({promptStarters:t,isSendBlocked:s,clientThreadId:o,isSquare:n,...a}){i.useEffect(()=>{kt(t,o)},[o]);const r=Hs(),l=Qn();return e.jsx(e.Fragment,{children:n?e.jsx(se.div,{...a,className:"mb-2 w-full flex-shrink overflow-y-hidden",children:e.jsx($t,{children:e.jsx(rr,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s})})}):e.jsx(se.div,{...a,className:"flex-shrink overflow-y-hidden",children:e.jsx(Wu,{starterPrompts:t,onSelectStarterPrompt:r,disabled:s,cssMobileDisplayLimit:2,marginOverride:D("mt-6",l?"@lg/thread:mt-12":"lg:mt-12")})})})}const yh=t=>{const[s,o]=i.useState([]),n=i.useCallback(async()=>{const r=(await _t.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:ks.Starter,title:zo(l),body:"",icon:e.jsx(Gc,{}),prompt:zo(l),id:`starter-${c}`,theme:yn.Search}));o(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:n}};function zo(t){return t.split(" ").map(Wc).join(" ")}const Vt=Ge({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),wh={HELP_WITH:Vt.whatCanIHelpWith,WHERE_TO_START:Vt.whereShouldWeStart,ASK_CHATGPT:Vt.askChatgptAnything};function yr({clientThreadId:t,currentLeafId:s}){const{currentModelId:o}=lr(),n=Os(t),a=pa(t,s),r=Ce(t),l=mt(),c=Gs(o),u=Ct(t)&&!a&&(Cs(n)||n?.kind===ze.GizmoTest),m=Rt(r);return{showEmptyState:u,canUseNewHomepage:u&&m||u&&!r&&!c&&!l}}const Go=ge.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function jh({conversation:t,gizmoResource:s,elementRef:o}){const n=Mi(t.id)??t.title;return e.jsx(pn,{to:ed(t.id,s),children:e.jsx(ae.Item,{icon:td,children:e.jsx("div",{ref:o,children:n})},t.id)})}function Ch({gizmoId:t,clientThreadId:s,inMobileHeader:o}){const n=Me(),{data:a}=Et(t),{items:r,hasNextPage:l,fetchNextPage:c,isLoading:u,isFetchingNextPage:m}=Xc(t),d=i.useRef(null),h=i.useCallback(R=>{u||R==null||(d.current?.disconnect(),d.current=new IntersectionObserver(E=>{E[0].isIntersecting&&l&&c()}),d.current.observe(R))},[u,l,c]);i.useEffect(()=>()=>{d.current?.disconnect()},[]);const{title:g,titleSource:v}=yi(s),f=Fe(),{conversationLeafId:x}=lr(),{showEmptyState:T}=yr({clientThreadId:s,currentLeafId:x}),y=Qt(s),j=Qc(),w=n.formatMessage(vn.newChatTitle),{resolvedTitle:S,isTypingEffect:A}=Zc(s,g??null,!0);if(!a||T)return null;const P=S==null&&(Ct(s)||v===wi.NewChat),_=y?e.jsx(e.Fragment,{}):e.jsxs(Go,{$isScreenArch:f,$shimmer:P,children:[e.jsx("div",{className:"truncate",children:A?e.jsx(sd,{text:S??""}):S??w}),e.jsx(Zn,{className:"icon-md text-token-text-tertiary"})]}),M=j&&a.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[a.gizmo.display.emoji," ",a.gizmo.display.name]}):a.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(Go,{$isScreenArch:f,children:e.jsx(pn,{className:"truncate",to:Do(a),children:M})}),e.jsxs(e.Fragment,{children:[e.jsx(ji,{className:"icon-md text-token-text-tertiary"}),e.jsxs(fa,{contentAlign:o?"center":"start",size:"small",triggerButton:_,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[e.jsx(pn,{to:Do(a),children:e.jsx(ae.Item,{icon:Jc,children:e.jsx(U,{...vn.newChatProjectDropdownItem,values:{name:`"${a.gizmo.display.name}"`}})},"new-chat")}),r.filter(R=>R.id!==s).map((R,E)=>{const p=l&&E===r.length-4?h:void 0;return e.jsx(jh,{elementRef:p,conversation:R,gizmoResource:a},R.id)}),m&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Ci,{})})]})]})]})}const Mh=We(()=>Ve(()=>import("./odbw041be85t4wt9.js"),__vite__mapDeps([16,2,1,3,4,5,17])).then(t=>t.ThreadHeaderGizmoDropdown)),Wo=ge.button`group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$isScreenArch:t})=>t?"h-[44px] @lg/screen-composer:pl-3 [line-height:26px] [font-size:17px] pl-1 pr-3":"px-3 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Th({clientThreadId:t}){const s=Me(),o=mt(),n=_i(t),a=Bn(),[,r]=wa(),l=()=>{!n&&!o?a({pathname:"/",search:new URLSearchParams({[ps]:"true"}).toString()}):r(c=>(c.get(ps)==="true"?c.delete(ps):c.set(ps,"true"),c),{replace:n,state:pd()})};return e.jsx(ae.Item,{size:"large",className:"!pr-3",onClick:l,icon:md,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(U,{...Mr.temporaryChat})}),e.jsx(hd,{enabled:o,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function _h(t){return t.title?t.title:t.shortLabel}function wr(t,s,o){let n=t;if(t===_o.AUTO){const l=s.filter(({defaultModel:c})=>c!==_o.AUTO);l.length===1&&(n=l[0].defaultModel)}const a=s.find(({defaultModel:l})=>l===n);if(a){const{categoryId:l}=a,c=_h(a);return{selectedCategory:l,modelLabel:c,omitPrefix:!!a.title}}const r=o.find(({modelIds:l})=>l.includes(n));if(r){const{group:l,shortLabel:c}=r;return{selectedCategory:l,modelLabel:c}}return{selectedCategory:null,modelLabel:null}}function kh({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function Nh({clientThreadId:t,inMobileHeader:s}){const{isLoading:o,categories:n,groups:a}=Jn(),r=Ti(),c=Us(t).id,u=nd(),{modelLabel:m,omitPrefix:d}=wr(c,n,a),h=Eh(t,u),g=Me(),{isUnauthenticated:v}=Be(),f=jr(),x=(!v||!f)&&!r;i.useEffect(()=>{o||od({namespace:Ga.ChatPageLoad})?.logTiming("render_model_switcher")},[o]);const T=Fe(),y=e.jsxs("div",{className:D(T?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[d?null:`${ad} `,x?e.jsx("span",{className:"text-token-text-secondary",children:m}):v&&m?e.jsx(kh,{modelLabel:m}):null]});return h.length?o?null:e.jsx(fa,{sideOffset:8,size:"large",triggerButton:e.jsxs(Wo,{$isScreenArch:T,"aria-label":m?g.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:m}):"",children:[y,T?e.jsx(rd,{className:"icon-md text-token-text-tertiary"}):e.jsx(Zn,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:j=>{K.logEvent(X.toggleModelSwitcher,{isOpen:j}),de.logEvent("toggle_model_switcher",null,{isOpen:String(j)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(Ih,{sections:h})}):e.jsx(Wo,{className:"cursor-default",children:y})}function jr(){return $e("462735957").value}function Ah({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:o,currentModelId:n,omitIcon:a,testId:r}){const{defaultModel:l,label:c,categoryId:u,description:m,isBeta:d}=t;return e.jsx(wn,{value:l,currentModelId:n,modelSwitcherDenialsBySlug:s,renderName:h=>e.jsx(_n,{categoryId:u,name:c,description:m,isDisabled:h,omitIcon:a,isBeta:d}),isSelected:!o&&n===l,testId:r},l)}function Eh(t,s){const o=Us(t),n=o.id,a=Ce(t),{categories:r,groups:l}=Jn(),{doesUserHaveAnyAccountsWithPlusFeatures:c}=Pn(),u=ee.getServerThreadId(t),m=id({clientThreadId:t}),d=Me(),h=!u,{isUnauthenticated:g}=Be(),v=ld(),{layer:f}=tt("2723963139"),x=f.get("is_dynamic_model_enabled",!1),T=jr(),y=s.find(({categoryId:I})=>I===Qe.ALPHA),j=s.find(({categoryId:I})=>I===Qe.DATA_CAMPAIGNS),w=s.find(({categoryId:I})=>I===Qe.EXPERIMENTS),S=s.find(({categoryId:I})=>I===Qe.MAINLINE),A=!0,P=!!y?.options?.length,_=!!j?.options?.length,M=!!w?.options?.length,R=!!S?.options?.length,E=Bn(),p=i.useCallback(()=>{K.logEvent(X.openModalAccountPaymentfromModelPicker,{content:"gizmo-button"}),cd(E,"Thread header dropdown")},[E]),B=()=>{de.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),K.logEvent(X.modelSwitcherPlusUpgradeButtonClicked),g?v({shouldOpenPaymentModalOnAuth:!0,callback:I=>{K.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:I})}}):p()},C=[],H=e.jsxs("div",{className:"mb-1 flex items-center justify-between px-5 pt-2",children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(U,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:x?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(Ia,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header");if(T&&g){const I={id:"modelSection",content:[]};I.content.push(e.jsx(dd,{},"noAuthUpsell")),C.push(I)}else if(c){const I={id:"modelSection",content:[]};r.length&&I.content.push(H);const b=new Map;r.forEach(F=>{const Y=e.jsx(Ah,{category:F,currentGizmoId:a,currentModelId:n,modelSwitcherDenialsBySlug:m,omitIcon:A,testId:`model-switcher-${F.defaultModel}`},F.categoryId);F.subcategory?(b.has(F.subcategory)||b.set(F.subcategory,[]),b.get(F.subcategory)?.push(Y)):I.content.push(Y)}),b.forEach((F,Y)=>{const te=r.find(q=>q.subcategory===Y&&q.defaultModel===o.id);I.content.push(e.jsxs(ae.Sub,{children:[e.jsx(ae.SubMenuTrigger,{"data-testid":Y==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[Y,!!te&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:te.label})]})}),e.jsx(ae.Portal,{children:e.jsx(ae.SubContent,{className:"min-w-72",children:F})})]},Y))}),C.push(I)}else{const I={id:"modelSection",content:[]};I.content.push(e.jsx(wn,{value:"",currentModelId:n,onClick:B,modelSwitcherDenialsBySlug:m,isUpgradeUpsell:!0,renderName:b=>e.jsx(_n,{icon:gd,isDisabled:b,name:d.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:d.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"}),omitIcon:!1}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),I.content.push(e.jsx(wn,{value:on.AUTO,currentModelId:n,modelSwitcherDenialsBySlug:m,renderName:b=>e.jsx(_n,{icon:ud,name:d.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:d.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:b,omitIcon:!1}),isSelected:!a&&n===on.AUTO,showNewChatHint:!0},on.AUTO)),C.push(I)}const z={id:"otherOptionsSection",content:[]},{selectedCategory:k}=wr(n,r,l);return h&&(P&&z.content.push(e.jsx(gs,{isSelected:k===Qe.ALPHA,currentModel:o,option:y,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},y.value)),_&&z.content.push(e.jsx(gs,{isSelected:k===Qe.DATA_CAMPAIGNS,currentModel:o,option:j,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},j.value)),M&&z.content.push(e.jsx(gs,{currentModel:o,isSelected:k===Qe.EXPERIMENTS,option:w,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},w.value)),R&&z.content.push(e.jsx(gs,{isSelected:k===Qe.MAINLINE,currentModel:o,option:S,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},S.value))),z.content.length&&C.push(z),g||C.push({id:"temporaryChatSection",content:[e.jsx(Th,{clientThreadId:t},"tempChat")]}),C}function Rh(){const t=Me();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(Mr.beta)})}function _n({isDisabled:t,name:s,icon:o,categoryId:n,description:a,extra:r,omitIcon:l,isBeta:c=!1}){let u=s;return c&&(u=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(Rh,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[!l&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:o?e.jsx(o,{className:"h-4 w-4 text-token-text-primary"}):n&&e.jsx($a,{type:"filled",className:D("h-4 w-4",t&&"text-gray-300",!t&&"text-token-text-primary"),categoryId:n})}),e.jsxs("div",{children:[u,e.jsxs("div",{className:D(!t&&"text-token-text-secondary","text-xs"),children:[a,r]})]})]})}function Ih({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,o)=>e.jsxs(Ca.Fragment,{children:[o!==0?e.jsx(ae.Separator,{}):null,s.content]},s.id))})}function Cr({clientThreadId:t,inMobileHeader:s=!1}){const o=Ce(t),n=Rt(o);return o==null?e.jsx(Nh,{clientThreadId:t,inMobileHeader:s}):n?e.jsx(Ch,{gizmoId:o,clientThreadId:t,inMobileHeader:s}):e.jsx(Mh,{clientThreadId:t,gizmoId:o,inMobileHeader:s})}const Mr=Ge({beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Ph=We(()=>Ve(()=>import("./fgwhi8yirqbn08vk.js"),__vite__mapDeps([18,1,2,3,19,20,4,5,21,22,23,24,25,26,15,14,27,28,29,30,31,13,17,32,33,34,35])).then(t=>t.GizmoUsingAsOwnerNotice)),Tr=({clientThreadId:t})=>{const s=zs(g=>g.activeStageSidebar),o=ee.getServerThreadId(t),n=fd(js.WorkspaceShareLinks),{isUnauthenticated:a}=Be(),r=mt(),l=Ce(t),c=Rt(l),u=n&&o&&!a&&!r&&!c,m=Fe(),d=xa(),h=!s&&!(!a&&m&&d.get("include_account_settings_move",!1));return e.jsx("div",{className:D(!m&&"gap-2",m&&"@lg/screen-composer:gap-2","flex items-center pr-1 leading-[0]"),children:e.jsx(em,{showShareButton:u,showProfileDropdown:h,clientThreadId:t})})};function Dh({clientThreadId:t,gizmoId:s}){const o=xd(),{data:n}=Et(s),a=Ds();return e.jsxs(e.Fragment,{children:[e.jsxs(vd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[n!=null&&a?.isWorkspaceAccount()&&n.gizmo.tags?.includes(Yn.WorkspaceDisabled)&&e.jsx(Ph,{gizmo:n}),e.jsx(Sd,{gizmoId:s,clientThreadId:t})]}),e.jsx(bd,{children:e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(cr,{clientThreadId:t}),e.jsx(Cr,{clientThreadId:t})]})}),e.jsx(Tr,{clientThreadId:t})]}),o&&e.jsx(yd,{})]})}function _r({clientThreadId:t}){const s=Ce(t),o=Rn(),n=Fe();return o||n?null:e.jsx(Dh,{gizmoId:s,clientThreadId:t})}function Lh({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,enableV2Homepage:a,v2HomepageDisclaimer:r}){const l=mt();let c=e.jsx(qu,{}),u;return l?(u=e.jsx(Bh,{}),c=e.jsx(Kt,{className:"mb-6 h-12 w-12"})):t!=null?(u=a?e.jsx(vr,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,v2HomepageDisclaimer:r}):e.jsx($u,{clientThreadId:t}),c=null):u=e.jsx(Fh,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,u]})}function Bh({gizmo:t}){const s=jd(),o=t?Cd(t.tools):!1,n=Ds();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Md,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(U,{...lt.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(U,{...n?.isWorkspaceAccount()?s?lt.temporaryChatBizMemoryAvailable:lt.temporaryChatBizMemoryUnavailable:s?lt.temporaryChatDescriptionMemoryAvailable:lt.temporaryChatDescriptionMemoryUnavailable}),o&&e.jsx("div",{className:"mt-3",children:e.jsx(U,{...lt.temporaryChatDescriptionGptActions,values:{link:a=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:a})}})})]})]})}function Fh(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(U,{...lt.howCanIHelpYouToday})})}function kr({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,enableV2Homepage:a,v2HomepageDisclaimer:r}){const l=Ce(t),c=ki(),u=An(),{data:m}=Et(l),d=wd(),h=Ni(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&m==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:h?.visible?D("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",d?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(_r,{clientThreadId:t})}),m!=null?e.jsx(Vu,{gizmo:m,showStarterPrompts:!0,disableStarterPrompts:u}):e.jsx(Lh,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,enableV2Homepage:a,v2HomepageDisclaimer:r})]})}const lt=Ge({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Hh({className:t,clientThreadId:s,message:o,onModelSelect:n,onDropdownChange:a}){const r=Me(),[l,c]=i.useState(null),[u,m]=i.useState(!1),[d,h]=i.useState(!1),g=Td(),v=Ya(s),f=Ce(s),x=Ka({clientThreadId:s,message:o}),T=o.message.metadata?.model_slug,{modelOptions:y,modelSlug:j,animateModelLabelOnRender:w,nuxProps:S,messageModelEnabledTools:A}=x,P=Xa(o.message),_=A.includes(Kn.Search),M=i.useMemo(()=>y.find(k=>k.value==T),[y,T]),{doesUserHaveAnyAccountsWithPlusFeatures:R}=Pn(),E=i.useRef(null),p=k=>{k||setTimeout(()=>{E.current&&E.current.blur()},10)};if(i.useEffect(()=>{p(u)},[u]),!g||f)return null;const B=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:r.formatMessage(Vo.search),icon:e.jsx(Un,{className:"icon-sm"}),condition:_&&!P,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:r.formatMessage(Vo.nosearch),icon:e.jsx(Qa,{className:"icon-sm"}),condition:_&&P,eventName:"chatgpt_regenerate_without_search_button_clicked"}];let C,H;S.shouldRenderNux?(C=Oh,H={title:e.jsx(U,{id:"g/+2Hh",defaultMessage:"Optimized your response"}),description:e.jsx(U,{id:"H0Flqm",defaultMessage:"Used {usedModelName} for a faster response that saves your limited {largestModelName} messages",values:{usedModelName:S.usedModelName,largestModelName:S.largestModelName}}),markAsViewed:S.announcement.markAsViewed}):(C=Uh,H={label:v?e.jsx(U,{id:"LBYK9a",defaultMessage:"Change model"}):e.jsx(U,{id:"nygjPN",defaultMessage:"Used {modelName}",values:{modelName:S.usedModelName}})});const z=v&&y.some(k=>Yt(k,R));return e.jsxs(ae.Root,{onOpenChange:k=>{v&&(m(k),a(k),p(k)),k&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:z})},children:[e.jsx(C,{...H,children:e.jsx(va,{ref:E,className:D("cursor-pointer",t),onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:e.jsx(Nr,{modelSlug:j,animateModelLabelOnRender:w,isDropdownOpen:u,isRegenerateEnabled:v,isHovered:d})})}),v&&e.jsxs(ae.Content,{className:"z-30 origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[y.map(k=>{const I=Yt(k,R),{value:b,...F}=k;return e.jsx(jt,{value:b,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...Je({clientThreadId:s})}),n({requestedModelId:b})},onMouseEnter:()=>c(b),onMouseLeave:()=>c(null),isHovered:l===b,messageModelSlug:o.message.metadata?.model_slug,shouldShowUpsell:I,...F},b)}),!!M&&e.jsxs(e.Fragment,{children:[e.jsx(ae.Separator,{}),B.filter(k=>k.condition).map(k=>e.jsx(jt,{onSelect:()=>{de.logEvent(k.eventName,M.value,{requestedModelId:M.value,...Je({clientThreadId:s})}),n({requestedModelId:M.value,extraStreamParams:k.extraStreamParams})},includeRegenerate:!0,onMouseEnter:()=>c(k.key),onMouseLeave:()=>c(null),isHovered:l===k.key,messageModelSlug:T,includeCheck:!1,...M,label:k.label,subtitle:"",icon:k.icon},k.key))]})]})]})}function Nr({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:o,isRegenerateEnabled:n,isHovered:a,isRegenLabel:r=!1,animateShortLabel:l,omitIcon:c}){const[u,m]=i.useState("initial"),{categories:d}=Jn({isRegen:!!r});i.useEffect(()=>{if(s){const y=setTimeout(()=>m("show"),500),j=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(y),clearTimeout(j)}}m("initial")},[s]);const h=d.find(({defaultModel:y})=>y===t),g=t===_d?{categoryId:"gpt_3.5",shorterLabel:"3.5"}:{},{categoryId:v,shorterLabel:f}=h??g,x={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},T=o?"visible":a?"show":u;return e.jsxs(se.div,{initial:"initial",animate:T,className:"flex items-center pb-0",children:[!c&&(r?e.jsx(eo,{className:"icon-md"}):v&&e.jsx($a,{type:"outline",categoryId:v,className:"icon-md h-4 w-4"})),(n||l)&&e.jsx(se.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:x,transition:{type:"tween",duration:.18},children:f}),n&&e.jsx(Zn,{className:D("icon-sm",{"text-token-text-quaternary":!a&&!r},{"text-token-text-secondary":a&&!r})})]})}function Uh({children:t,label:s}){return e.jsx(Ps,{label:s,sideOffset:0,children:t})}function Oh({children:t,title:s,description:o,markAsViewed:n}){return e.jsx(zn,{announcementKey:dt.ModelSwitcherAutoDowngrade,show:!0,side:"bottom",sideOffset:-4,title:s,description:o,badge:"beta",onDismiss:n,dismissOnOutsideClick:!0,children:t})}function Yt(t,s){const{modelSwitcherDeny:o,subscriptionLevel:n}=t;return!!o&&o.reason===Ai.RATE_LIMIT&&n===Ei.PLUS&&!s}const Vo=Ge({search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),zh=i.memo(Hh),ys="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Gh({className:t,clientThreadId:s,message:o,onModelSelect:n,onDropdownChange:a,canRegenerateResponse:r}){const[c,u]=i.useState(null),[m,d]=i.useState(!1),[h,g]=i.useState(!1),v=Ce(s),f=Ka({clientThreadId:s,message:o}),x=o.message.metadata?.model_slug,T=o.message.id,{modelOptions:y,modelSlug:j,animateModelLabelOnRender:w,messageModelEnabledTools:S}=f,A=Xa(o.message),P=S.includes(Kn.Search),_=i.useMemo(()=>y.find(C=>C.value===x),[y,x]),M=i.useRef(null),{doesUserHaveAnyAccountsWithPlusFeatures:R}=Pn(),E=C=>{C||setTimeout(()=>{M.current&&M.current.blur()},10)};if(i.useEffect(()=>{E(m)},[m]),Ri(s))return null;const B=r&&y.some(C=>Yt(C,R));return v?null:e.jsxs(ae.Root,{onOpenChange:C=>{r&&(d(C),a(C),E(C)),C&&K.logEvent(X.conversationOpenMessageModelSelector,{has_get_plus_button:B,is_new_regen_dropdown:!0})},children:[r?e.jsx(Vh,{label:e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(va,{ref:M,className:D("cursor-pointer",t),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:e.jsx(Nr,{modelSlug:j,animateModelLabelOnRender:w,isDropdownOpen:m,isRegenerateEnabled:r,isHovered:h,isRegenLabel:!0,omitIcon:!1})})}):null,r&&e.jsx(ae.Portal,{children:e.jsxs(ae.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(ae.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Wh,{clientThreadId:s,messageId:T,onModelSelect:n,messageModelSlug:x,omitModelIcons:!0,modelOptions:y,setHoveredOption:u,hoveredOption:c,retryOption:_,lastResponseUsedSearch:A,modelSupportsSearch:P,doesUserHaveAnyAccountsWithPlusFeatures:R})]})})]})}function Wh({clientThreadId:t,messageId:s,modelOptions:o,messageModelSlug:n,onModelSelect:a,omitModelIcons:r,setHoveredOption:l,hoveredOption:c,retryOption:u,lastResponseUsedSearch:m,modelSupportsSearch:d,doesUserHaveAnyAccountsWithPlusFeatures:h}){const g=Me(),[v,f]=i.useMemo(()=>kd(o,w=>w.subcategory),[o]),x=i.useMemo(()=>{const w=new Map;return v.forEach(S=>{const A=S.subcategory;A&&(w.has(A)||w.set(A,[]),w.get(A)?.push(S))}),w},[v]),T=D("icon-sm",r&&"order-10 ml-auto text-token-text-tertiary icon-md"),y=r?"right":"left",j=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:g.formatMessage(ln.search),icon:e.jsx(Un,{className:T}),condition:d&&!m,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:g.formatMessage(ln.nosearch),icon:e.jsx(Qa,{className:T}),condition:d&&m,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[f.map(w=>{const{value:S,...A}=w;return e.jsx(jt,{value:S,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",S,{requestedModelId:S,...Je({clientThreadId:t,messageId:s})}),a({requestedModelId:S})},includeRegenerate:!1,onMouseEnter:()=>l(S),onMouseLeave:()=>l(null),isHovered:c===S,messageModelSlug:n,includeCheck:!1,shouldShowUpsell:Yt(w,h),className:ys,...A,icon:r?e.jsx("span",{className:T}):A.icon,justifyIcon:y,wrapIcon:!r},S)}),[...x.entries()].map(([w,S])=>e.jsxs(ae.Sub,{children:[e.jsx(ae.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:w})}),e.jsx(ae.Portal,{children:e.jsx(ae.SubContent,{className:"min-w-fit",children:S.map(A=>{const{value:P,..._}=A;return e.jsx(jt,{value:P,onSelect:()=>{de.logEvent("chatgpt_regenerate_switch_model_button_clicked",P,{requestedModelId:P,...Je({clientThreadId:t,messageId:s})}),a({requestedModelId:P})},includeRegenerate:!1,onMouseEnter:()=>l(P),onMouseLeave:()=>l(null),isHovered:c===P,messageModelSlug:n,includeCheck:!1,className:ys,..._,icon:null,justifyIcon:y,wrapIcon:!r,shouldShowUpsell:Yt(A,h)},w+"-"+P)})})})]},w)),!!u&&e.jsxs(e.Fragment,{children:[e.jsx(ae.Separator,{}),e.jsx(jt,{onSelect:()=>{de.logEvent("chatgpt_regenerate_try_again_button_clicked",u.value,{requestedModelId:u.value,...Je({clientThreadId:t,messageId:s})}),a({requestedModelId:u.value})},includeRegenerate:!0,onMouseEnter:()=>l(u.value),onMouseLeave:()=>l(null),messageModelSlug:n,includeCheck:!1,className:ys,...u,label:g.formatMessage(ln.tryAgain),subtitle:u.label,icon:e.jsx(eo,{className:T}),justifyIcon:y,wrapIcon:!r},u.value),j.filter(w=>w.condition).map(w=>e.jsx(jt,{onSelect:()=>{de.logEvent(w.eventName,u.value,{requestedModelId:u.value,...Je({clientThreadId:t,messageId:s})}),a({requestedModelId:u.value,extraStreamParams:w.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>l(w.key),onMouseLeave:()=>l(null),isHovered:c===w.key,messageModelSlug:n,includeCheck:!1,className:ys,...u,label:w.label,subtitle:"",icon:w.icon,justifyIcon:y,wrapIcon:!r},w.key))]})]})}function Vh({children:t,label:s}){return e.jsx(Ps,{label:s,sideOffset:0,children:t})}const ln=Ge({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),qh=i.memo(Gh),qo=We(()=>Ve(()=>import("./mc2tj3xhtcshtn61.js").then(t=>t.qv),__vite__mapDeps([4,2,1,3,5])).then(t=>t.MemoryActionResult));function $o(t,s,o){ee.updateTree(t,n=>{n.updateNodeMetadata(s,{inlineComparisonRating:o})})}function Yo(t){return{is_dark_mode:t,time_since_loaded:Math.floor(performance.now()/1e3),page_height:window?.innerHeight,page_width:window?.innerWidth,pixel_ratio:window?.devicePixelRatio,screen_height:window?.screen?.height,screen_width:window?.screen?.width}}const Ko=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:o}=s??{};if(o)return o}};function $h(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(Ar,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o,...t}):e.jsx(Yh,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o})}function Yh(t){const{clientThreadId:s,variantIds:o,variantsInStreamInfo:n,turnIndex:a,firstVisibleTokenTimestampsRef:r}=t;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=ro(),c=Xh(),u=In(),m=Ii(),[d,h]=i.useMemo(()=>Za(o.join(""))()<.5?[0,1]:[1,0],[o[0],o[1]]),g=d<h?"left":"right",v=g==="left"?"right":"left",f=o[d],x=o[h],T=wt(qe(s,E=>E?.tree.getLeafFromNode(f))).id,y=wt(qe(s,E=>E?.tree.getLeafFromNode(x))).id,j=wt(gn(s,a,T)),w=wt(gn(s,a,y)),S=g==="left"?j:w,A=g==="left"?w:j,P=n.display_treatment==="unskippable",_=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(Sn.setState({displayingSideBySideFeedback:!0,unskippable:P}),()=>{Sn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[P]),Nd();const M=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>Pi(Di,{requestCompletion:()=>{const E=Ze(S.messages)?.completionSampleFinishTime,p=Ze(A.messages)?.completionSampleFinishTime,B=ee.getServerThreadId(s);if(c){const H=ee.getTree(s).getParentPromptNode(T),z=[j,w].map((b,F)=>({messageId:b.messages[b.messages.length-1].message.id,loadFirstTokenTime:F===0?r.current.left:r.current.right,loadEndTime:Ze(b.messages)?.completionSampleFinishTime})),k={},I=H.metadata?.variantsInStreamInfo==null&&H.message.metadata?.paragen_variants_info!=null;for(const b of z)k[b.messageId]=I?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:b.loadFirstTokenTime,load_end_time:b.loadEndTime};ws({shouldUseNewParagenEndpoint:c,params:{conversation_id:B,displayed_message_ids:z.map(b=>b.messageId),message_metadatas:k,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:H.message.id}})}else ws({shouldUseNewParagenEndpoint:c,params:{feedback_version:_,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:A.messages[A.messages.length-1]?.message.id,conversation_id:B,completion_comparison_rating:"skip",new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:E??0,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:p??0,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Yo(m),...M.current}})}}),[j,w,T,s,t.conversationTurnMountTime,_,v,S?.messages,A?.messages,m,c,l,r]);const R=E=>{const B=ee.getTree(s).getLeafFromNode(E);ee.setThreadCurrentLeafId(s,B.id);const C=E===f,H=C===(g==="left"),z=Ze(S.messages)?.completionSampleFinishTime,k=Ze(A.messages)?.completionSampleFinishTime;S.messages.length>0&&$o(s,S.messages[S.messages.length-1].nodeId,H?"original":"new"),A.messages.length>0&&$o(s,A.messages[A.messages.length-1].nodeId,H?"original":"new");let I;z==null||k==null?I=H?"partial_load_comparison_original":"partial_load_comparison_new":I=H?"original":"new";const b=ee.getServerThreadId(s);if(c){const F=[j,w].map((Q,ue)=>({messageId:Q.messages[Q.messages.length-1].message.id,loadFirstTokenTime:ue===0?r.current.left:r.current.right,loadEndTime:Ze(Q.messages)?.completionSampleFinishTime})),Y=C?F[0].messageId:F[1].messageId,q=ee.getTree(s).getParentPromptNode(T),re={},ie=q.metadata?.variantsInStreamInfo==null&&q.message.metadata?.paragen_variants_info!=null;for(const Q of F)re[Q.messageId]=ie?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:Q.loadFirstTokenTime,load_end_time:Q.loadEndTime};ws({shouldUseNewParagenEndpoint:c,params:{conversation_id:b,displayed_message_ids:F.map(Q=>Q.messageId),message_metadatas:re,rating:"selected",selected_message_id:Y,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:q.message.id}})}else ws({shouldUseNewParagenEndpoint:c,params:{feedback_version:_,original_message_id:S.messages[S.messages.length-1]?.message.id,new_message_id:A.messages[A.messages.length-1]?.message.id,conversation_id:b,completion_comparison_rating:I,new_completion_placement:v,feedback_start_time:t.conversationTurnMountTime,compare_step_start_time:t.conversationTurnMountTime,original_completion_load_start_time:t.conversationTurnMountTime,original_completion_load_end_time:z??null,new_completion_load_start_time:t.conversationTurnMountTime,new_completion_load_end_time:k??null,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset(),client_contextual_info:Yo(m),...M.current}})};return e.jsx(Ar,{...t,setPreferredFeedback:R,leftVariantId:f,rightVariantId:x,leftTurn:j,rightTurn:w,hasActiveRequest:u,originalTurn:S,visibilityStateRef:M})}function Kh(t){if(!t.length)return!1;const s=t.filter(o=>o.type===Lo.Text||o.type===Lo.MultiText).filter(o=>o.message.message.status!=="finished_successfully"&&o.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(o=>{const n=o.message.message.content;return n?.content_type===Sa.Text&&n.parts.join("")===""})}function Ar({setPreferredFeedback:t,leftVariantId:s,rightVariantId:o,leftTurn:n,rightTurn:a,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...u}){const{defaultParagenLabel:m,shouldShowParagenLabels:d=!1}=Ea(),h=n&&Ko(n)||m,g=a&&Ko(a)||m,v=i.useMemo(()=>n?.messages??[],[n?.messages]),f=i.useMemo(()=>a?.messages??[],[a?.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:T}=u,y=i.useMemo(()=>Es(v),[v]),j=i.useMemo(()=>Es(f),[f]),w=ka(),[S,A]=i.useMemo(()=>[y,j].map(F=>Kh(F)),[y,j]),P=ct(n?Ms.getRequestIdFromConversationTurn(n):"")||S,_=ct(a?Ms.getRequestIdFromConversationTurn(a):"")||A,M=n?.role===Le.User,R=a?.role===Le.User,E=i.useRef(null),p=i.useRef(null),B=i.useRef(null),C=u.stubSideBySideFeedback||S,H=u.stubSideBySideFeedback||A;!C&&T.current.left==null&&(T.current.left=Date.now()),!H&&T.current.right==null&&(T.current.right=Date.now()),i.useEffect(()=>{if(E.current&&p.current&&B.current){const F=Array(11).fill(0).map((te,q)=>q/10),Y=new IntersectionObserver(te=>te.forEach(q=>{q.target===p.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=q.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,q.intersectionRatio)):q.target===B.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=q.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,q.intersectionRatio))}),{root:E.current,threshold:F});return Y.observe(p.current),Y.observe(B.current),()=>Y.disconnect()}},[c]);const{data:z}=Na(void 0,!1,w),k=ro(),I=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),b=Fe();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",b&&"top-[var(--thread-leading-height)] pt-3",!b&&"top-[-1px]",k&&!b?"md:top-header-height":b?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),k?I:null]}),k?null:I,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:E,children:e.jsx("div",{className:D(!b&&"min-w-fit"),children:e.jsxs("div",{className:D("mx-auto flex max-w-6xl items-start",k&&!b&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!k&&!b&&"gap-4 sm:gap-6",k&&b&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",b&&!k&&"gap-4 sm:gap-6"),children:[e.jsxs(Xo,{horizontalScrollContainerRef:E,rootElementRef:p,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:C,children:[e.jsxs(Jo,{children:[e.jsx(jn,{messages:v,isUserTurn:M,avatarClassName:x}),e.jsx(Zo,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(U,{...ta.responseNumber,values:{responseIndex:1}})})]}),k&&C?e.jsx(Qo,{}):e.jsxs(e.Fragment,{children:[z!=null&&!M&&e.jsx(qo,{clientThreadId:u.clientThreadId,messages:v,isParagen:!0}),e.jsx(Cn,{...u,groupedMessagesToRender:y,allGroupedMessages:y,isEditing:!1,isUserTurn:M,isCompletionRequestInProgress:P,hasActiveRequest:r,handleEnterEdit:hs,handleExitEdit:hs,shouldGrowContainer:!1}),e.jsx(ea,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:n,originalTurn:l})]})]}),e.jsxs(Xo,{horizontalScrollContainerRef:E,rootElementRef:B,onClick:()=>{t(o)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:H,children:[e.jsxs(Jo,{children:[e.jsx(jn,{messages:f,isUserTurn:R,avatarClassName:x}),e.jsx(Zo,{children:d?e.jsx("span",{className:"font-bold text-token-text-primary",children:g}):e.jsx(U,{...ta.responseNumber,values:{responseIndex:2}})})]}),k&&H?e.jsx(Qo,{}):e.jsxs(e.Fragment,{children:[z!=null&&!R&&e.jsx(qo,{clientThreadId:u.clientThreadId,messages:f,isParagen:!0}),e.jsx(Cn,{...u,groupedMessagesToRender:j,allGroupedMessages:j,isEditing:!1,isUserTurn:R,isCompletionRequestInProgress:_,hasActiveRequest:r,handleEnterEdit:hs,handleExitEdit:hs,shouldGrowContainer:!1}),e.jsx(ea,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:a,originalTurn:l})]})]})]})})})]})}function Xo({horizontalScrollContainerRef:t,rootElementRef:s,onClick:o,children:n,hasActiveRequest:a,isWaitingOnFirstUserVisibleToken:r}){const l=ro(),c=Fe(),{scrollX:u}=Qi({layoutEffect:!1,container:t,target:s}),m=Ad(),d=Ed(),h=i.useRef(null),g=i.useRef(null),v=i.useRef(null),[f,x]=i.useState(!1),[T,y]=i.useState(!1),[j,w]=i.useState(!1),[S,A]=i.useState(0);i.useEffect(()=>{if(!l)return;const B=new IntersectionObserver(C=>{for(const H of C)H.target===h.current?x(H.isIntersecting):H.target===v.current?w(H.isIntersecting):H.target===g.current&&y(H.isIntersecting)},{root:m?.current,rootMargin:c?`0px 0px -${S}px 0px`:void 0});return h.current&&g.current&&v.current&&(B.observe(h.current),B.observe(g.current),B.observe(v.current)),()=>{B.disconnect()}},[S,l,c,m]);const P=!j&&(T||f),_=Zi(u,B=>P?-1*B:0),M=ko(0);i.useEffect(()=>{if(!l)return;const B=new ResizeObserver(C=>{fs(C.length===1,"entryList.length === 1");const H=C[0];fs(H.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),M.set(H.contentBoxSize[0].inlineSize)});return s.current&&B.observe(s.current),()=>{B.disconnect()}},[l,M,s]);const R=ko(0);i.useEffect(()=>{if(!l)return;const B=new ResizeObserver(C=>{fs(C.length===1,"entryList.length === 1");const H=C[0];fs(H.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),R.set(H.contentBoxSize[0].blockSize+16),A(H.contentBoxSize[0].blockSize)});return d.current&&B.observe(d.current),()=>{B.disconnect()}},[l,R,d]);const E=e.jsx(At,{className:l?"px-5":"mt-4 self-start",onClick:o,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),p=r;return e.jsxs("div",{"data-paragen-root":!0,className:D("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:D("absolute left-0 right-0 top-48 h-px","invisible"),ref:h}),e.jsx("div",{className:D("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:g}),e.jsx("div",{className:D("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:v}),n,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:p?null:e.jsx(se.div,{style:{translateX:_,width:M,bottom:R},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:P,"z-20 flex w-full justify-center":!0}),children:E})}):a?null:E]})}function Qo(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(it,{className:"h-4 w-[75%]"}),e.jsx(it,{className:"h-4 w-[50%]"}),e.jsx(it,{className:"h-4 w-[80%]"}),e.jsx(it,{className:"h-4 w-[55%]"}),e.jsx(it,{className:"h-4 w-[66%]"}),e.jsx(it,{className:"h-4 w-[64%]"}),e.jsx(it,{className:"h-4 w-[48%]"})]})}function ro(){const{layer:t}=tt("3119715334");return t.get("should-enable-hojicha",!1)}const Zo=ge.div`text-sm text-token-text-secondary font-semibold`,Jo=ge.div`flex gap-4 items-center mb-1`,it=ge.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function ea({clientThreadId:t,conversationTurnMountTime:s,turn:o,originalTurn:n}){const a=$n();if(!a.showParagenMetadata||!a.showDebugConversationTurns&&!a.forceParagen||o==null)return null;let r=o===n?"ORIGINAL":"NEW";const l=o.messages[o.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:h,model_definition_slug:g,model_definition_virtual_model_id:v,alternative_model_selection_rule:f,augmented_paragen_prompt_group_id:x,augmented_paragen_prompt_id:T,augmented_paragen_prompt:y}=c;h&&(r+=`
Model ID: ${h}`),g&&(r+=`
Model Slug: ${g}`),v&&(r+=`
Virtual Model ID: ${v}`),f&&(r+=`
Alternative Model Rule: ${f}`),x&&(r+=`
Prompt Group ID: ${x}`),T&&(r+=`
Prompt ID: ${T}`),y&&(r+=`
Prompt: ${y}`)}r+=`
Message ID: ${l.message.id}`;const m=ee.getTree(t).getParentPromptNode(o.variantIds[0]),d=m.metadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${m.message.id}`,r+=`
Is Persisted Paragen? ${d}`,r+=`
Completion Sample Finish Time: ${d?`${s} (persisted)`:Ze(o.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function ws({shouldUseNewParagenEndpoint:t,params:s}){t?await _t.submitParagenSelectionV2(s):await _t.submitMessageComparisonFeedback(s)}function Xh(){const{value:t}=$e("3894844102");return t}const ta=Ge({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}}),sa=[1,2,3,4,10,20,30],Qh=.5;function Zh({clientThreadId:t,conversationLeafId:s}){const o=Ja(er.isBusinessWorkspace),n=i.useRef(!1),a=Xt(t),r=Ls(t),{isUnauthenticated:l}=Be(),c=i.useMemo(()=>{if(!a)return-1;const R=Za(a);return R()>Qh?-1:sa[Math.floor(R()*sa.length)]},[a]),u=Li(t,s),m=u[u.length-1],d=i.useMemo(()=>Ms.getRequestIdFromConversationTurn(m),[m]),h=ct(d),[g,v]=i.useState(null),[f,x]=i.useState(!1),[T,y]=i.useState(!1),[j,w]=i.useState(!1),S=R=>{const E=Ze(u)?.messages[0]?.message.id;v(R),_(E,R)},A=u.filter(R=>R.role===Le.Assistant).length,P=m?.role===Le.Assistant,_=i.useMemo(()=>Va((R,E)=>{a&&R&&_t.submitConversationRating({conversation_id:a,message_id:R,rating:E,shown_at_assistant_turn:c}),K.logEvent(X.conversationRatingSubmitted,{rating:E,showAtAssistantTurn:c,conversationId:a}),x(!0),setTimeout(()=>{y(!0)},1500)},2e3),[a,c]),M=A!==c||h||!P||!!o||r?.kind!==ze.PrimaryAssistant||j||l;return i.useEffect(()=>{!M&&!n.current&&(K.logEvent(X.conversationRatingShown,{showAtAssistantTurn:c,conversationId:a}),n.current=!0)},[M]),j||M?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(Zt,{children:f&&!T&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(na,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!f&&e.jsx(se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(na,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(U,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(cn,{$selected:g==="thumbsUp",onClick:()=>S("thumbsUp"),children:e.jsx(tr,{className:"icon-md"})}),e.jsx(cn,{$selected:g==="thumbsDown",onClick:()=>S("thumbsDown"),children:e.jsx(sr,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(cn,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:e.jsx(Bi,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const cn=ge.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,na=ge.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Jh=We(()=>Ve(()=>import("./ofvygecxwbzaihl1.js"),__vite__mapDeps([36,1,2,3,4,5,37])));function eg({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:o,messageForRating:n,allGroupedMessages:a,currentModelId:r}){let l=null;const c=Fs(g=>{const v=ba.getCacheAwareConversationTurns(Fi(t,g),s);let f=0;for(let x=v.length-1;x>=0;x--){const T=v[x];if(T.messages.some(y=>y.message.metadata?.is_indepth_feedback))return!0;if(T.messages.some(y=>y.message.author.role===Le.Assistant)&&f++,f>=3)break}return!1}),u=Xt(t),m=zs(g=>g.voiceFeedbackThread),d=u===m,{voiceName:h}=Rd();return c?null:(d&&u?(Hi.feedbackShown.success({voice:h}),l=e.jsx("div",{className:"text-center",children:e.jsx(Id,{serverThreadId:u})})):n.rating&&o?l=e.jsx(Jh,{clientThreadId:t,conversationMessage:n,allGroupedMessages:a,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(Zh,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const tg=We(()=>Ve(()=>import("./nrci5t4pa80sj25y.js"),__vite__mapDeps([38,1,2,3,39,40,4,5,41])).then(t=>t.VoicePlayButton)),oa=128,aa={minHeight:"calc(100cqh - var(--thread-leading-height) - var(--thread-trailing-height) - var(--previous-turn-min-height))"};function sg(t){const{turnIndex:s,conversationLeafId:o,isFinalTurn:n,clientThreadId:a,onChangeItemInView:r,onChangeRating:l,currentModelId:c,avatarClassName:u,showAvatar:m=!0,scrollToMessageId:d,shouldShowDateHeader:h}=t,g=Me(),v=Wn(),f=!!v&&Ui(v),x=Rn(),T=Ja(er.isBusinessWorkspace),y=ca(),{value:j}=$e("2848981774"),w=ee.getServerThreadId(a),S=wt(gn(a,s,o)),{messages:A,variantIds:P,variantsInStreamInfo:_}=S,M=Es(A),R=Pd();let E=A[A.length-1];for(const G of M){const he=zu(G);if(he.some(De=>R.has(De.message.id))){E=he[he.length-1];break}}const p=A.slice(0,A.indexOf(E)+1),B=As(),[C,H]=i.useState(!1),[z,k]=i.useState(!1),I=P.findIndex(G=>p.some(he=>he.nodeId===G)),b=S.role===Le.User,F=mt(),Y=Ce(a),te=Et(S.gizmoId??Y)?.data,q=Gs(c),re=Dd(c),ie=Fe(),Q=Ls(a,te?.gizmo.id),Te=ua(a)===ma.STREAMING,He=!1,{value:le}=En("2291672486"),pe=p.some(G=>G.message.content.content_type===Sa.MultimodalText),{layer:_e}=tt("1547743984"),ve=w&&B&&_e.get("show_share_button_inline",!1),{isUnauthenticated:Ee}=Be(),[Re,Ue]=i.useState(!1),[ke,O]=i.useState(!1),L=S.messages.map(G=>G.message.id),V=i.useRef(null),W=A[A.length-1],Z=W.rating,ne=(d?.length??0)>2&&d!=="finalAgentTurn"&&n&&j&&ie,me=()=>{p.length===1&&(K.logEvent(X.editPrompt,{id:p[0].message.id,threadId:ee.getServerThreadId(a)}),de.logEvent("chatgpt_edit_prompt"),H(!0))},Se=i.useCallback(()=>{H(!1)},[]),oe=i.useCallback(G=>{Ld(a,s,y,G)},[a,s,y]),Ie=G=>{l({nodeId:W.nodeId,messageId:W.message.id,rating:G}),K.logEvent(G==="thumbsDown"?X.messageFeedbackThumbsDownClicked:X.messageFeedbackThumbsUpClicked,{id:W.message.id,threadId:ee.getServerThreadId(a),model:c,rating:G}),k(!0)},[$]=i.useState(()=>Date.now()),be=i.useMemo(()=>Ms.getRequestIdFromConversationTurn(S),[S]),Pe=ha({clientThreadId:a,conversationLeafId:o}),fe=ct(be)&&!Pe,It=In(),ye=Es(p),Ye=i.useRef(!1);i.useEffect(()=>{if(Ye.current||d===void 0||!j||!ie||!V.current){d==="finalAgentTurn"&&n&&Ye.current&&ee.updateScrollToMessageId(a,void 0);return}(L.includes(d)||d==="finalAgentTurn"&&n)&&(Ye.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(V.current)if(d==="finalAgentTurn"&&n)V.current.scrollIntoView({behavior:"instant",block:"end"}),ee.updateScrollToMessageId(a,void 0);else{const G=V.current.offsetHeight;let he;G>oa?he=oa-G:he=0,V.current.style.scrollMarginTop=`calc(${he}px + 2px + var(--thread-leading-height))`,V.current.scrollIntoView({behavior:"smooth"})}})}))},[d,V.current]);const{showDebugConversationTurns:ht}=$n(),Pt=ga(a),Jt=Ya(a),gt=Bd({clientThreadId:a,conversationMode:Q}),st=ut(a),Dt=i.useCallback(({requestedModelId:G,systemMessage:he,juice:De,extraStreamParams:bt})=>{const Ot=new qt;gt({id:W.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:Ot,requestedModelId:G,systemMessage:he,juice:De,extraStreamParams:bt})},[W,gt]),Ne=He,Lt=!x&&!Pt&&!F&&!b,es=Fd(),pt=E.message.author.role===Le.Assistant?E.message:null;Hd({isCompletionRequestInProgress:fe,isUserTurn:b,message:pt});const Bt=qe(a,G=>G?.tree!=null&&P.some(he=>{const De=G.tree.getLeafFromNode(he);return G.tree.getHasErrorFromNode(De.id)})),{isOpen:Ft}=Ud(),Ke=Od(Q),nt=!es&&!Ke&&Lt&&n&&_?.num_variants_in_stream===2&&!W.inlineComparisonRating&&!Bt,ts=zd(S),ot=nt,Xe=nt&&!ts,at=!b&&!x&&!Pt&&!Ke&&!Te&&!fe&&!Ft,Ht=at&&(!T||Ne||re||f)&&!Ke&&!Ee&&!F,ft=!x&&!((fe||Te)&&n)&&P.length>1&&!C&&!ot;let xt=!1;if(b&&p.length===1){const{shouldHideContent:G}=Gd(p[0]);G&&(xt=!0)}const Vs=b&&!Ke&&!x&&!pe&&p.length===1&&!xt&&!C&&!Ee,ss=G=>{r(P[G]),K.logEvent(X.changeNode,{intent:"toggle_between"})};if(!Wd(S,p,ht)&&!ot)return ne?e.jsx("div",{style:aa}):null;const os=p.some(({message:G})=>Oi.getAssetPointers(G).length>0),vt=!os&&n&&Jt&&!le?e.jsx(xs,{onClick:()=>{de.logEvent("chatgpt_regenerate_try_again_button_clicked",c,{requestedModelId:c,...Je({clientThreadId:a,turnIndex:s})});const G=new qt;gt({id:st,eventMetadata:{eventSource:"mouse"},turnTracker:G}),Ts()},icon:eo,label:g.formatMessage({id:"ConversationTurn.regenerateTooltip",defaultMessage:"Regenerate"}),testId:"regenerate-turn-action-button"}):null,we="h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",Ut=!os&&le?e.jsx(qh,{className:we,clientThreadId:a,message:W,onModelSelect:Dt,onDropdownChange:Ue,canRegenerateResponse:Jt}):null,Ys=!b&&!xt&&(!n||!fe)?e.jsx(su,{onClick:oe}):null,Ks=!b&&(!n||!fe)&&(W.disclaimers??[]).length===0&&W.nodeId?e.jsx(tg,{conversationId:a,message:W,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Xs=!b&&W&&(!n||!fe)?e.jsx(nu,{message:W,isFinalTurn:n,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,as=Ht&&!fe?e.jsxs("div",{className:"flex",children:[Z!=="thumbsDown"&&e.jsx(xs,{onClick:()=>Ie("thumbsUp"),disabled:Z==="thumbsUp",icon:Z==="thumbsUp"?Vd:tr,label:g.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${W.nodeId}`),Z!=="thumbsUp"&&e.jsx(xs,{onClick:()=>Ie("thumbsDown"),disabled:Z==="thumbsDown",icon:Z==="thumbsDown"?qd:sr,label:g.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${W.nodeId}`)]}):null,rs=ve&&e.jsx(xs,{onClick:()=>{Ns.openSharingModal(w)},label:g.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:$d}),St=!le&&e.jsx(zh,{className:we,clientThreadId:a,message:W,onModelSelect:Dt,onDropdownChange:Ue});function Qs(G){return ie?G:e.jsx(Xn,{clientThreadId:a,isStaticSharedThread:x,withVerticalPadding:!0,withHorizontalPadding:!ot,children:G})}function Zs(G){return ie?G:e.jsx($t,{children:G})}return e.jsxs(e.Fragment,{children:[h&&e.jsx(Yd,{turn:S}),e.jsxs("article",{className:D("w-full scroll-mb-[var(--thread-trailing-height,150px)] text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",d==="finalAgentTurn"&&j&&ie?"opacity-0":""),style:ne?aa:void 0,ref:V,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":n,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:[e.jsx(Kd,{role:S.role}),Qs(e.jsx(e.Fragment,{children:ot?e.jsx($h,{isFeedbackEnabled:Ht,variantIds:P,variantsInStreamInfo:_,conversationTurnMountTime:$,stubSideBySideFeedback:Xe,...t}):Zs(e.jsxs(e.Fragment,{children:[!b&&m&&e.jsx(ng,{children:e.jsx(jn,{messages:p,isUserTurn:b,avatarClassName:u,gizmo:te})}),e.jsx("div",{className:D("group/conversation-turn relative flex w-full min-w-0 flex-col",!b&&Xd),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[!b&&!x&&e.jsx(Qd,{messages:p,clientThreadId:a,gizmoId:te?.gizmo.id}),!1,e.jsx(Cn,{groupedMessagesToRender:ye,allGroupedMessages:M,...t,isEditing:C,isUserTurn:b,isCompletionRequestInProgress:fe,isFeedbackEnabled:Ht,isFinalTurn:n,hasActiveRequest:It,showEditButton:Vs,handleEnterEdit:me,handleExitEdit:Se}),q&&e.jsx("div",{className:"mb-4",children:e.jsx(Zd,{messages:p})}),(at||ft)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:D("mb-2 flex gap-3 empty:hidden",b?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Jd,{alwaysShow:n,showInline:n||ft,isHovered:ke||Re,pagination:ft&&e.jsx(eu,{showInline:n||ft,currentPage:I,onChangeIndex:ss,length:P.length,className:D("self-center",P.length>1?"visible":"!invisible")}),actions:at&&e.jsxs(e.Fragment,{children:[Ks,Ys,vt,as,Xs,St,rs,Ut]})})}),at&&!fe?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(tu,{message:W,isFinalTurn:n})}):null,n&&!fe&&e.jsx(eg,{canShowInlineMessageFeedback:z,clientThreadId:a,conversationLeafId:o,messageForRating:W,allGroupedMessages:M,currentModelId:c})]})]})})})]}))}))]})]})}const kn=Ca.memo(sg),ng=ge.div`flex-shrink-0 flex flex-col relative items-end`;function og({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:o,onRequestCompletion:n,clientThreadId:a,conversationLeafId:r,hideHeader:l}){const c=xe(),u=Bs(),m=ou(),[d]=au(),h=ru(),[g]=iu(),v=Ls(a),f=Ds(),x=Us(a),y=ee.getConversationOrigin(a)===zi.APPLE,j=c.store.useContentAreaDimensions(Nt.Header,F=>F?.height?F.height:void 0),w=c.store.useIsHeaderContentAreaPopulated(),S=ya(a),{isArchived:A}=S,P=lu(x.id),_=v?.kind===ze.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":P,M=Dn(a,r),R=cu(),[E,p]=i.useState(0),[B,C]=i.useState(!1);i.useEffect(()=>{u&&(E===0?p(M):!B&&M>E&&(C(!0),de.logEvent("chatgpt_continue_conversation_first_message_sent"),K.logEvent(X.continueConversationFirstMessageSent)))},[M,E,B,u]),i.useEffect(()=>{u&&(de.logEvent("chatgpt_continue_conversation_page_loaded"),K.logEvent(X.continueConversationPageLoaded),de.logEvent("chatgpt_conversation_share_page_loaded"),K.logEvent(X.sharedConversationPageLoaded))},[u]);const H=i.useCallback(()=>{m({behavior:"smooth"})},[m]),z=du(a),k=R&&!A,I=nr(a,r),b=(F,Y,te)=>[...new Array(Y-F).keys()].map(q=>{const re=q+F;return e.jsx(kn,{isFinalTurn:te(re),turnIndex:re,clientThreadId:a,conversationLeafId:r,onChangeItemInView:t,onChangeRating:o,onRequestMoreCompletions:s,onRequestCompletion:n,currentModelId:x.id,avatarClassName:_,scrollToBottom:H,shouldShowDateHeader:I(re)},re)});return e.jsxs("div",{onCopy:z,className:D("flex flex-col text-sm",k&&"pb-[120px]",j||k?null:"md:pb-9"),style:{paddingBottom:k?void 0:j},children:[!l&&f?.data&&e.jsx(_r,{clientThreadId:a}),u&&e.jsxs(e.Fragment,{children:[e.jsx($t,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),M-E===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Ns.openModal(uu.ReportConversation),de.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),K.logEvent(X.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),b(0,E,F=>F===E-1),e.jsx($t,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(mu,{className:"icon-xs mr-2"}),e.jsx(U,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),b(E,M,F=>F===M-1)]}),!u&&b(0,M,F=>F===M-1),y&&d&&!g&&e.jsx(ra,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{de.logEvent("chatgpt_thread_scroll_to_top"),h({behavior:"smooth"})},children:e.jsx(hu,{className:"icon-md text-token-text-primary"})}),!d&&e.jsx(ra,{className:D(j?null:"bottom-5",k?w?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:R?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":j},onClick:()=>{de.logEvent("chatgpt_thread_scroll_to_bottom"),m({behavior:"smooth"})},children:e.jsx(gu,{className:"icon-md text-token-text-primary"})})]})}const ra=ge.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,ag=60,rg=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:o=0})=>{const n=i.useRef(null);return e.jsx("div",{className:"h-full",ref:n,children:e.jsx(Ln,{children:e.jsx(Ou,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>ig(n,o)?0:1/0,children:t})})})},ig=(t,s)=>{const o=lg(t.current);if(o==null)return!1;const n=o>s,a=o<s-ag;return!n&&!a};function lg(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const o=s.getBoundingClientRect().top,n=t.getBoundingClientRect().top;return o-n}const cg=We(()=>Ve(()=>import("./dpnd5rvmowlzdknv.js"),__vite__mapDeps([42,2,1,3,4,5,43,44,45,46,47,41,48])).then(t=>t.OpenDebugSidebarButton)),dg=We(()=>Ve(()=>import("./kugo6b3670z02rfe.js"),__vite__mapDeps([49,1,4,2,3,5]))),ia=Ge({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function ug({clientThreadId:t}){const s=ja(),o=Xt(t),n=async()=>{o&&(await _t.patchConversation(o,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),Fs.setState(a=>{const r=a.threads[o];r!=null&&(r.initialThreadData.isArchived=!1)}),Ru(s))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(U,{...ia.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(At,{disabled:!o,onClick:n,icon:Au,children:e.jsx(U,{...ia.unarchiveButton})})})]})}const _g=function({clientThreadId:t,onCompletionFinished:s,onCreate:o,preRequestCompletion:n,hideHeader:a,hideMessages:r,hideFooter:l,hideToolsOverlay:c,messagesVerticalAlign:u="top",prependThreadChildren:m,renderEmptyState:d,prefetchSearch:h}){const g=da(),v=Os(t),f=Qt(t),x=ut(t),y=ya(t).isArchived;Gi(t),i.useEffect(()=>{f||(Ct(t)?hn.addTiming("chatgpt.web.chatPage.renderNewConversation"):hn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,f]);const j=pa(t,x),w=Dn(t,x),{setTargetedContent:S}=qn(),A=g?.includes(Wi),P=pu(),_=w>=2;Vn(_);const M=Ct(t)&&!_&&Cs(v),R=Ct(t)&&!j&&(Cs(v)||v?.kind===ze.GizmoTest),p=za().id,B=Vi(t),C=B??p,H=!!B,z=Gs(C),I=Oa()[C],b=fu(t,v),F=Ua();or(w,t,x),i.useEffect(()=>{F||S(void 0)},[t,S,F,x]);const{caModal:Y,onRequestCompletion:te,onChangeItemInView:q,onChangeRating:re,onRequestMoreCompletions:ie}=xu({clientThreadId:t,currentModelId:C,defaultModelId:p,onCompletionFinished:s,onThreadCreated:o,preRequestCompletion:n}),{isUnauthenticated:Q,isLoading:ue}=Be(),Te=ar({clientThreadId:t,currentLeafId:x,handleRequestCompletion:te,prefetchSearchPromise:h});vu({clientThreadId:t,currentModelId:C});const He=Ie=>e.jsx(rg,{scrollAnchorTopOffset:a?0:Eu,children:u==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),Ie]}):Ie});i.useEffect(()=>{document.title=b??"ChatGPT"},[b]);const le=Ce(t),pe=mt(),_e=qi(),ve=R&&!_e&&!d&&!le&&!z&&!pe,Ee=ve&&!ue&&Q,Re=ve&&!ue&&!Q,Ue=ch(Ee),ke=uh(Re),O=Ee&&Ue||Re&&ke,L=Bs(),V=Su(),{reset:W,streamingContext:Z,StreamingProvider:ne}=bu();i.useEffect(()=>{V&&(Z.setOnResetContext=()=>{W()})},[V,W,Z]);const me=i.useRef(null),Se=i.useRef(null),oe=i.useMemo(()=>({threadContentScrollContainerElementRef:me,footerRootContainerElementRef:Se}),[]);return e.jsx(yu,{clientThreadId:t,currentLeafId:x,children:e.jsxs(ne,{value:Z,children:[A&&e.jsx(dg,{}),e.jsx(wu,{children:b!=null&&e.jsx("title",{children:b})}),e.jsx($i.Provider,{value:te,children:e.jsxs(ju,{children:[e.jsxs(Cu,{clientThreadId:t,currentModelConfig:I,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!r&&e.jsx(Mu,{value:oe,children:e.jsx(mg,{ref:me,children:!f&&!Te?R?d??e.jsx(kr,{clientThreadId:t,currentModelId:C,isModelLoaded:H,onRequestCompletion:te,enableV2Homepage:O,v2HomepageDisclaimer:O&&e.jsx(Rs,{clientThreadId:t})}):_?He(e.jsxs(e.Fragment,{children:[m,e.jsx(og,{onChangeItemInView:q,onRequestMoreCompletions:ie,onChangeRating:re,onRequestCompletion:te,clientThreadId:t,conversationLeafId:x,hideHeader:a},t)]})):null:null})}),e.jsx(hg,{ref:Se,children:y?e.jsx(ug,{clientThreadId:t}):e.jsxs("div",{children:[!O&&e.jsx(ah,{clientThreadId:t,isNewThread:M,showPromptStarters:M||!j,currentModelId:C,onRequestCompletion:te}),!l&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Cs(v)&&!O&&e.jsx("div",{className:"min-h-4",children:e.jsx(Rs,{clientThreadId:t})})})]})})]}),!c&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[P?e.jsxs(e.Fragment,{children:[e.jsx(cg,{}),!1]}):null,e.jsx(Tu,{})]}),Y,e.jsx(_u,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:L}),e.jsx(ku,{}),e.jsx(Nu,{conversationId:t,currentModelId:C,isActiveWindow:!_e})]})})]})})},mg=ge.div`grow flex-1 overflow-hidden @container/thread`,hg=ge.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;function gg({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,v2HomepageDisclaimer:a}){return e.jsx(vr,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,v2HomepageDisclaimer:a})}const pg=We(()=>Ve(()=>import("./d17yebpu6s43fip7.js"),__vite__mapDeps([50,1,51,4,2,3,5,14])).then(t=>t.ChatScreenContentModals));function fg({disableEmptyState:t,fullWidth:s,renderEmptyState:o}){const{clientThreadId:n,currentModelId:a,conversationLeafId:r,isCompanionWindow:l,isEmbeddedInFocusedView:c,onChangeItemInView:u,onChangeRating:m,onRequestCompletion:d,onRequestMoreCompletions:h,isModelLoaded:g,prefetchSearch:v}=i.useContext(dr),f=Dn(n,r),x=qe(n,ba.getScrollToMessageId),T={clientThreadId:n,conversationLeafId:r,currentModelId:a,onChangeItemInView:u,onChangeRating:m,onRequestMoreCompletions:h,onRequestCompletion:d,showAvatar:!1},y=Qt(n),j=ar({clientThreadId:n,currentLeafId:r,handleRequestCompletion:d,prefetchSearchPromise:v}),w=y||j||t,S=Bs(),{initialConversationTurns:A,continuedConversationTurns:P}=Iu(f,S),{canUseNewHomepage:_,showEmptyState:M}=yr({clientThreadId:n,currentLeafId:r}),R=f>=2;Vn(R);const{setTargetedContent:E}=qn(),p=Gs(a);or(f,n,r),i.useEffect(()=>{c||E(void 0)},[n,E,c]);const B=nr(n,r);if(M){if(o!=null)return o();if(_&&!w){const C=l?null:e.jsx("div",{className:"text-center text-xs text-token-text-secondary",children:e.jsx(Rs,{clientThreadId:n})});return e.jsx(gg,{clientThreadId:n,currentModelId:a,isModelLoaded:g,onRequestCompletion:d,v2HomepageDisclaimer:C})}else if(!_&&!w)return e.jsx(kr,{clientThreadId:n,currentModelId:a,isModelLoaded:g,onRequestCompletion:d,enableV2Homepage:!p,v2HomepageDisclaimer:e.jsx(Rs,{clientThreadId:n})})}return e.jsxs(e.Fragment,{children:[S&&e.jsx(Pu,{}),S&&P.length===0&&e.jsx(Du,{}),e.jsx(Ln,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(Lu,{}),A.length>0&&e.jsx("ol",{className:et.conversationTurnList,children:A.map(({turnIndex:C,isFinalTurn:H})=>e.jsx("li",{className:D(et.conversationTurnWrapper,s&&"w-full"),children:i.createElement(kn,{...T,key:`${n}-${C}`,turnIndex:C,isFinalTurn:H,scrollToMessageId:x,shouldShowDateHeader:B(C)})},C))}),S&&e.jsx(Bu,{}),e.jsx("ol",{className:et.conversationTurnList,children:P.map(({turnIndex:C,isFinalTurn:H})=>e.jsx("li",{className:D(et.conversationTurnWrapper,s&&"w-full"),children:i.createElement(kn,{...T,key:`${n}-${C}`,turnIndex:C,isFinalTurn:H,scrollToMessageId:x,shouldShowDateHeader:B(C)})},C))})]})}),e.jsx(pg,{}),f>0&&e.jsx(Fu,{})]})}function kg({renderEmptyState:t}){return e.jsx(fg,{renderEmptyState:t})}function Ng(){const{clientThreadId:t,isLoggedInUser:s,onNewThread:o}=i.useContext(dr),n=Ce(t),a=Rt(n),r=Fe(),l=xa(),c=zs(d=>!d.isDesktopNavCollapsed),m=l.get("include_legacy_sidebar_contents",!1)&&c;return e.jsxs(Hu,{leading:!0,type:"primary",className:et.header,children:[e.jsxs("div",{className:et.headerLeading,children:[!r&&a&&e.jsx(cr,{clientThreadId:t,hideNewChat:!0}),s&&!m&&e.jsx(Uu,{}),!a&&!m&&e.jsx(tm,{onNewThread:o,className:"hidden @lg/thread:inline-flex"}),e.jsx("div",{className:et.threadDropdown,children:e.jsx(Cr,{clientThreadId:t})})]}),e.jsx("div",{className:et.headerTrailing,children:e.jsx(Ln,{children:e.jsx(Tr,{clientThreadId:t})})})]})}export{Ng as C,Wo as G,fr as P,Cr as T,rg as W,_g as a,_r as b,kg as c,ah as d,kn as e,Tg as f,yr as u};
//# sourceMappingURL=nhuh8jcuqx1lx1ir.js.map
